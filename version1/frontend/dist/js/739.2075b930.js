"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[739],{552:(e,a,r)=>{r.d(a,{Eo:()=>s,Rv:()=>o,a6:()=>l});var t=r(335);const s={register:e=>t.A.post("/users/register",e),login:e=>t.A.post("/users/login",e),getCurrentUser:()=>t.A.get("/users/me"),updateUser:e=>t.A.put("/users/me",e),getUsers:e=>t.A.get("/users",{params:e})},l={createProduct:e=>t.A.post("/products",e),getProducts:e=>t.A.get("/products",{params:e}),getProductById:e=>t.A.get(`/products/${e}`),updateProduct:(e,a)=>t.A.put(`/products/${e}`,a),deleteProduct:e=>t.A.delete(`/products/${e}`),getMyProducts:()=>t.A.get("/products/my"),searchProducts:e=>t.A.get("/products/search",{params:{keyword:e}})},o={applyTrade:e=>t.A.post("/trades/apply",e),acceptTrade:e=>t.A.post(`/trades/${e}/accept`),rejectTrade:e=>t.A.post(`/trades/${e}/reject`),cancelTrade:e=>t.A.post(`/trades/${e}/cancel`),completeTrade:e=>t.A.post(`/trades/${e}/complete`),getTradeById:e=>t.A.get(`/trades/${e}`),getMyBuyTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return t.A.get(`/trades/buyer/${e?.id}`)},getMySellTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return t.A.get(`/trades/seller/${e?.id}`)},getProductTrades:e=>t.A.get(`/trades/product/${e}`)}},739:(e,a,r)=>{r.r(a),r.d(a,{default:()=>v});var t=r(641),s=r(33);const l={class:"user-center-container"},o={class:"tabs-container"},d={class:"profile-content"},i={class:"profile-header"},n={class:"avatar-section"},u={class:"user-info"},c={class:"security-content"},p={class:"security-tips"},m=["src"],g={key:1,class:"el-icon-plus avatar-uploader-icon"},f={class:"dialog-footer"};function h(e,a,r,h,b,w){const k=(0,t.g2)("el-avatar"),F=(0,t.g2)("el-button"),v=(0,t.g2)("el-input"),y=(0,t.g2)("el-form-item"),A=(0,t.g2)("el-radio"),_=(0,t.g2)("el-radio-group"),C=(0,t.g2)("el-form"),U=(0,t.g2)("el-tab-pane"),P=(0,t.g2)("el-card"),V=(0,t.g2)("el-alert"),$=(0,t.g2)("el-tabs"),I=(0,t.g2)("el-upload"),L=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",l,[(0,t.bF)(P,{class:"center-card"},{header:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"个人中心")],-1)])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",o,[(0,t.bF)($,{modelValue:b.activeTab,"onUpdate:modelValue":a[9]||(a[9]=e=>b.activeTab=e),onTabClick:w.handleTabClick},{default:(0,t.k6)(()=>[(0,t.bF)(U,{label:"个人信息",name:"profile"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",d,[(0,t.Lk)("div",i,[(0,t.Lk)("div",n,[(0,t.bF)(k,{size:100,src:b.userInfo.avatar||b.defaultAvatar},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(w.getUserInitial(b.userInfo.username)),1)]),_:1},8,["src"]),(0,t.bF)(F,{type:"primary",size:"small",onClick:a[0]||(a[0]=e=>b.showAvatarUpload=!0),class:"change-avatar-btn"},{default:(0,t.k6)(()=>[...a[13]||(a[13]=[(0,t.eW)(" 更换头像 ",-1)])]),_:1})]),(0,t.Lk)("div",u,[(0,t.Lk)("h2",null,(0,s.v_)(b.userInfo.username),1),(0,t.Lk)("p",null,(0,s.v_)(b.userInfo.email||"未设置邮箱"),1),(0,t.Lk)("p",null,"注册时间："+(0,s.v_)(w.formatDate(b.userInfo.registrationTime)),1),(0,t.Lk)("p",null,"发布商品："+(0,s.v_)(b.userStats.productCount)+" 件",1),(0,t.Lk)("p",null,"交易成功率："+(0,s.v_)(w.calculateSuccessRate())+"%",1)])]),(0,t.bF)(C,{model:b.profileForm,rules:b.profileRules,ref:"profileFormRef","label-width":"100px",class:"profile-form"},{default:(0,t.k6)(()=>[(0,t.bF)(y,{label:"昵称",prop:"nickname"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.profileForm.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>b.profileForm.nickname=e),placeholder:"请输入昵称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,{label:"性别"},{default:(0,t.k6)(()=>[(0,t.bF)(_,{modelValue:b.profileForm.gender,"onUpdate:modelValue":a[2]||(a[2]=e=>b.profileForm.gender=e)},{default:(0,t.k6)(()=>[(0,t.bF)(A,{label:"1"},{default:(0,t.k6)(()=>[...a[14]||(a[14]=[(0,t.eW)("男",-1)])]),_:1}),(0,t.bF)(A,{label:"2"},{default:(0,t.k6)(()=>[...a[15]||(a[15]=[(0,t.eW)("女",-1)])]),_:1}),(0,t.bF)(A,{label:"0"},{default:(0,t.k6)(()=>[...a[16]||(a[16]=[(0,t.eW)("保密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(y,{label:"邮箱",prop:"email"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.profileForm.email,"onUpdate:modelValue":a[3]||(a[3]=e=>b.profileForm.email=e),placeholder:"请输入邮箱",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,{label:"手机号码",prop:"phone"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.profileForm.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>b.profileForm.phone=e),placeholder:"请输入手机号码",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,{label:"个性签名",prop:"bio"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.profileForm.bio,"onUpdate:modelValue":a[5]||(a[5]=e=>b.profileForm.bio=e),type:"textarea",rows:3,placeholder:"请输入个性签名",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,null,{default:(0,t.k6)(()=>[(0,t.bF)(F,{type:"primary",onClick:w.submitProfile,loading:b.submitting},{default:(0,t.k6)(()=>[...a[17]||(a[17]=[(0,t.eW)("保存修改",-1)])]),_:1},8,["onClick","loading"]),(0,t.bF)(F,{onClick:w.resetProfile},{default:(0,t.k6)(()=>[...a[18]||(a[18]=[(0,t.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])])]),_:1}),(0,t.bF)(U,{label:"安全设置",name:"security"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",c,[(0,t.bF)(P,{class:"security-item"},{header:(0,t.k6)(()=>[...a[19]||(a[19]=[(0,t.Lk)("div",{class:"security-item-header"},[(0,t.Lk)("span",null,"修改密码")],-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(C,{model:b.passwordForm,rules:b.passwordRules,ref:"passwordFormRef","label-width":"120px",class:"password-form"},{default:(0,t.k6)(()=>[(0,t.bF)(y,{label:"原密码",prop:"oldPassword"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.passwordForm.oldPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>b.passwordForm.oldPassword=e),type:"password",placeholder:"请输入原密码"},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,{label:"新密码",prop:"newPassword"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.passwordForm.newPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>b.passwordForm.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,{label:"确认新密码",prop:"confirmPassword"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:b.passwordForm.confirmPassword,"onUpdate:modelValue":a[8]||(a[8]=e=>b.passwordForm.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(y,null,{default:(0,t.k6)(()=>[(0,t.bF)(F,{type:"primary",onClick:w.submitPassword,loading:b.submittingPassword},{default:(0,t.k6)(()=>[...a[20]||(a[20]=[(0,t.eW)("修改密码",-1)])]),_:1},8,["onClick","loading"]),(0,t.bF)(F,{onClick:w.resetPassword},{default:(0,t.k6)(()=>[...a[21]||(a[21]=[(0,t.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),(0,t.bF)(P,{class:"security-item"},{header:(0,t.k6)(()=>[...a[22]||(a[22]=[(0,t.Lk)("div",{class:"security-item-header"},[(0,t.Lk)("span",null,"账户安全提示")],-1)])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",p,[(0,t.bF)(V,{title:"为了您的账户安全，请定期更换密码",type:"info",closable:!1,"show-icon":""}),(0,t.bF)(V,{title:"请勿与他人共享您的账户信息",type:"warning",closable:!1,"show-icon":""}),(0,t.bF)(V,{title:"在使用完账号后，请及时登出",type:"warning",closable:!1,"show-icon":""})])]),_:1})])]),_:1})]),_:1},8,["modelValue","onTabClick"])])]),_:1}),(0,t.bF)(L,{modelValue:b.showAvatarUpload,"onUpdate:modelValue":a[11]||(a[11]=e=>b.showAvatarUpload=e),title:"更换头像",width:"30%"},{default:(0,t.k6)(()=>[(0,t.bF)(I,{class:"avatar-uploader",action:"","http-request":w.uploadAvatar,"show-file-list":!1,"auto-upload":!1,"on-change":w.handleAvatarChange,accept:"image/*"},{default:(0,t.k6)(()=>[b.previewAvatar?((0,t.uX)(),(0,t.CE)("img",{key:0,src:b.previewAvatar,class:"avatar"},null,8,m)):((0,t.uX)(),(0,t.CE)("i",g))]),_:1},8,["http-request","on-change"]),(0,t.Lk)("div",f,[(0,t.bF)(F,{onClick:a[10]||(a[10]=e=>b.showAvatarUpload=!1)},{default:(0,t.k6)(()=>[...a[23]||(a[23]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(F,{type:"primary",onClick:w.confirmAvatarUpload,loading:b.uploadingAvatar},{default:(0,t.k6)(()=>[...a[24]||(a[24]=[(0,t.eW)("确定",-1)])]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue"])])}var b=r(552);const w={name:"UserCenter",data(){return{activeTab:"profile",userInfo:{username:"",email:"",registrationTime:"",avatar:""},userStats:{productCount:0,tradeSuccessCount:0,tradeTotalCount:0},defaultAvatar:"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png",profileForm:{nickname:"",gender:"0",email:"",phone:"",bio:""},profileRules:{nickname:[{required:!1,max:50,message:"昵称不能超过50个字符",trigger:"blur"}],email:[{required:!1,type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!1,pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],bio:[{required:!1,max:200,message:"个性签名不能超过200个字符",trigger:"blur"}]},passwordForm:{oldPassword:"",newPassword:"",confirmPassword:""},passwordRules:{oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,a,r)=>{a!==this.passwordForm.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},showAvatarUpload:!1,previewAvatar:"",avatarFile:null,submitting:!1,submittingPassword:!1,uploadingAvatar:!1}},mounted(){this.loadUserInfo(),this.loadUserStats()},methods:{async loadUserInfo(){try{const e=await b.Eo.getUserInfo();this.userInfo=e,this.profileForm={nickname:e.nickname||"",gender:e.gender?.toString()||"0",email:e.email||"",phone:e.phone||"",bio:e.bio||""}}catch(e){this.$message.error("加载用户信息失败")}},async loadUserStats(){try{const e=await b.Eo.getUserStats();this.userStats=e}catch(e){this.userStats={productCount:0,tradeSuccessCount:0,tradeTotalCount:0}}},handleTabClick(e){},getUserInitial(e){return e?e.charAt(0).toUpperCase():"U"},formatDate(e){if(!e)return"";const a=new Date(e);return a.toLocaleString("zh-CN")},calculateSuccessRate(){return 0===this.userStats.tradeTotalCount?0:Math.round(this.userStats.tradeSuccessCount/this.userStats.tradeTotalCount*100)},async submitProfile(){this.$refs.profileFormRef.validate(async e=>{if(e){this.submitting=!0;try{await b.Eo.updateUserInfo(this.profileForm),this.$message.success("个人信息更新成功"),this.loadUserInfo()}catch(a){this.$message.error("更新失败，请重试")}finally{this.submitting=!1}}})},resetProfile(){this.$refs.profileFormRef.resetFields()},async submitPassword(){this.$refs.passwordFormRef.validate(async e=>{if(e){this.submittingPassword=!0;try{await b.Eo.changePassword(this.passwordForm),this.$message.success("密码修改成功，请重新登录"),this.$router.push("/login")}catch(a){this.$message.error(a.response?.data?.message||"密码修改失败，请检查原密码是否正确")}finally{this.submittingPassword=!1}}})},resetPassword(){this.$refs.passwordFormRef.resetFields()},handleAvatarChange(e){this.avatarFile=e.raw,this.previewAvatar=URL.createObjectURL(e.raw)},async uploadAvatar(){},async confirmAvatarUpload(){if(this.avatarFile){this.uploadingAvatar=!0;try{const e=new FormData;e.append("avatar",this.avatarFile);const a=await b.Eo.uploadAvatar(e);this.$message.success("头像上传成功"),this.showAvatarUpload=!1,this.userInfo.avatar=a.avatarUrl}catch(e){this.$message.error("头像上传失败，请重试")}finally{this.uploadingAvatar=!1}}else this.$message.warning("请选择要上传的头像")}}};var k=r(262);const F=(0,k.A)(w,[["render",h],["__scopeId","data-v-2b851987"]]),v=F}}]);
//# sourceMappingURL=739.2075b930.js.map