"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[723],{552:(e,t,a)=>{a.d(t,{Eo:()=>l,Rv:()=>i,a6:()=>s});var r=a(335);const l={register:e=>r.A.post("/users/register",e),login:e=>r.A.post("/users/login",e),getCurrentUser:()=>r.A.get("/users/me"),updateUser:e=>r.A.put("/users/me",e),getUsers:e=>r.A.get("/users",{params:e})},s={createProduct:e=>r.A.post("/products",e),getProducts:e=>r.A.get("/products",{params:e}),getProductById:e=>r.A.get(`/products/${e}`),updateProduct:(e,t)=>r.A.put(`/products/${e}`,t),deleteProduct:e=>r.A.delete(`/products/${e}`),getMyProducts:()=>r.A.get("/products/my"),searchProducts:e=>r.A.get("/products/search",{params:{keyword:e}})},i={applyTrade:e=>r.A.post("/trades/apply",e),acceptTrade:e=>r.A.post(`/trades/${e}/accept`),rejectTrade:e=>r.A.post(`/trades/${e}/reject`),cancelTrade:e=>r.A.post(`/trades/${e}/cancel`),completeTrade:e=>r.A.post(`/trades/${e}/complete`),getTradeById:e=>r.A.get(`/trades/${e}`),getMyBuyTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return r.A.get(`/trades/buyer/${e?.id}`)},getMySellTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return r.A.get(`/trades/seller/${e?.id}`)},getProductTrades:e=>r.A.get(`/trades/product/${e}`)}},723:(e,t,a)=>{a.r(t),a.d(t,{default:()=>V});var r=a(641),l=a(33),s=a(751);const i={class:"user-trades-container"},o={class:"trade-content"},n={class:"search-filter"},c={class:"product-info-wrapper"},d=["src"],u={class:"product-details"},g={class:"product-name"},p={class:"product-price"},h={class:"user-name"},b={class:"pagination-container"},m={class:"trade-content"},y={class:"search-filter"},T={class:"product-info-wrapper"},f=["src"],k={class:"product-details"},C={class:"product-name"},w={class:"product-price"},v={class:"user-name"},S={class:"pagination-container"},D={class:"dialog-footer"};function F(e,t,a,F,_,P){const z=(0,r.g2)("el-input"),L=(0,r.g2)("el-option"),V=(0,r.g2)("el-select"),R=(0,r.g2)("el-date-picker"),A=(0,r.g2)("el-table-column"),$=(0,r.g2)("el-tooltip"),x=(0,r.g2)("el-tag"),W=(0,r.g2)("el-button"),U=(0,r.g2)("el-table"),N=(0,r.g2)("el-pagination"),Q=(0,r.g2)("el-tab-pane"),B=(0,r.g2)("el-tabs"),j=(0,r.g2)("el-card"),I=(0,r.g2)("el-dialog"),X=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.bF)(j,{class:"trades-card"},{header:(0,r.k6)(()=>[...t[13]||(t[13]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"我的交易")],-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:_.activeTab,"onUpdate:modelValue":t[10]||(t[10]=e=>_.activeTab=e),onTabClick:P.handleTabClick},{default:(0,r.k6)(()=>[(0,r.bF)(Q,{label:"我发起的交易",name:"buyer"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",o,[(0,r.Lk)("div",n,[(0,r.bF)(z,{modelValue:_.buyerSearchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>_.buyerSearchQuery=e),placeholder:"搜索商品名称","prefix-icon":"el-icon-search",class:"search-input",clearable:""},null,8,["modelValue"]),(0,r.bF)(V,{modelValue:_.buyerTradeStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>_.buyerTradeStatus=e),placeholder:"选择交易状态",clearable:"",class:"status-select"},{default:(0,r.k6)(()=>[(0,r.bF)(L,{label:"全部",value:""}),(0,r.bF)(L,{label:"待确认",value:"0"}),(0,r.bF)(L,{label:"已接受",value:"1"}),(0,r.bF)(L,{label:"已拒绝",value:"2"}),(0,r.bF)(L,{label:"已完成",value:"3"}),(0,r.bF)(L,{label:"已取消",value:"4"})]),_:1},8,["modelValue"]),(0,r.bF)(R,{modelValue:_.buyerDateRange,"onUpdate:modelValue":t[2]||(t[2]=e=>_.buyerDateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"date-picker"},null,8,["modelValue"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(U,{data:P.filteredBuyerTrades,style:{width:"100%"},"empty-text":P.buyerEmptyText,onRowClick:P.viewTradeDetail},{default:(0,r.k6)(()=>[(0,r.bF)(A,{prop:"id",label:"交易ID",width:"100"}),(0,r.bF)(A,{prop:"productName",label:"商品信息","min-width":"300"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",c,[(0,r.Lk)("img",{src:P.getProductImage(e.row.product.images),class:"product-image"},null,8,d),(0,r.Lk)("div",u,[(0,r.Lk)("div",g,(0,l.v_)(e.row.productName),1),(0,r.Lk)("div",p,"¥"+(0,l.v_)(e.row.productPrice),1)])])]),_:1}),(0,r.bF)(A,{prop:"sellerName",label:"卖家",width:"120"},{default:(0,r.k6)(e=>[(0,r.bF)($,{content:e.row.sellerContact||"暂无联系方式"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",h,(0,l.v_)(e.row.sellerName),1)]),_:2},1032,["content"])]),_:1}),(0,r.bF)(A,{prop:"status",label:"交易状态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(x,{type:P.getStatusType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(P.getStatusText(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(A,{prop:"createdTime",label:"申请时间",width:"180"}),(0,r.bF)(A,{prop:"updatedTime",label:"更新时间",width:"180"}),(0,r.bF)(A,{label:"操作",width:"150",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(W,{type:"primary",size:"small",onClick:(0,s.D$)(t=>P.viewTradeDetail(e.row),["stop"]),class:"btn-view"},{default:(0,r.k6)(()=>[...t[14]||(t[14]=[(0,r.eW)(" 详情 ",-1)])]),_:1},8,["onClick"]),0===e.row.status?((0,r.uX)(),(0,r.Wv)(W,{key:0,type:"danger",size:"small",onClick:(0,s.D$)(t=>P.cancelTrade(e.row),["stop"]),class:"btn-cancel"},{default:(0,r.k6)(()=>[...t[15]||(t[15]=[(0,r.eW)(" 取消 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0),1===e.row.status?((0,r.uX)(),(0,r.Wv)(W,{key:1,type:"success",size:"small",onClick:(0,s.D$)(t=>P.confirmReceive(e.row),["stop"]),class:"btn-confirm"},{default:(0,r.k6)(()=>[...t[16]||(t[16]=[(0,r.eW)(" 确认收货 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["data","empty-text","onRowClick"])),[[X,_.buyerLoading]]),(0,r.Lk)("div",b,[(0,r.bF)(N,{"current-page":_.buyerCurrentPage,"onUpdate:currentPage":t[3]||(t[3]=e=>_.buyerCurrentPage=e),"page-size":_.buyerPageSize,"onUpdate:pageSize":t[4]||(t[4]=e=>_.buyerPageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:_.buyerTotal,onSizeChange:P.handleBuyerSizeChange,onCurrentChange:P.handleBuyerCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),_:1}),(0,r.bF)(Q,{label:"我收到的交易",name:"seller"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",m,[(0,r.Lk)("div",y,[(0,r.bF)(z,{modelValue:_.sellerSearchQuery,"onUpdate:modelValue":t[5]||(t[5]=e=>_.sellerSearchQuery=e),placeholder:"搜索商品名称","prefix-icon":"el-icon-search",class:"search-input",clearable:""},null,8,["modelValue"]),(0,r.bF)(V,{modelValue:_.sellerTradeStatus,"onUpdate:modelValue":t[6]||(t[6]=e=>_.sellerTradeStatus=e),placeholder:"选择交易状态",clearable:"",class:"status-select"},{default:(0,r.k6)(()=>[(0,r.bF)(L,{label:"全部",value:""}),(0,r.bF)(L,{label:"待确认",value:"0"}),(0,r.bF)(L,{label:"已接受",value:"1"}),(0,r.bF)(L,{label:"已拒绝",value:"2"}),(0,r.bF)(L,{label:"已完成",value:"3"}),(0,r.bF)(L,{label:"已取消",value:"4"})]),_:1},8,["modelValue"]),(0,r.bF)(R,{modelValue:_.sellerDateRange,"onUpdate:modelValue":t[7]||(t[7]=e=>_.sellerDateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"date-picker"},null,8,["modelValue"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(U,{data:P.filteredSellerTrades,style:{width:"100%"},"empty-text":P.sellerEmptyText,onRowClick:P.viewTradeDetail},{default:(0,r.k6)(()=>[(0,r.bF)(A,{prop:"id",label:"交易ID",width:"100"}),(0,r.bF)(A,{prop:"productName",label:"商品信息","min-width":"300"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",T,[(0,r.Lk)("img",{src:P.getProductImage(e.row.product.images),class:"product-image"},null,8,f),(0,r.Lk)("div",k,[(0,r.Lk)("div",C,(0,l.v_)(e.row.productName),1),(0,r.Lk)("div",w,"¥"+(0,l.v_)(e.row.productPrice),1)])])]),_:1}),(0,r.bF)(A,{prop:"buyerName",label:"买家",width:"120"},{default:(0,r.k6)(e=>[(0,r.bF)($,{content:e.row.buyerContact||"暂无联系方式"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",v,(0,l.v_)(e.row.buyerName),1)]),_:2},1032,["content"])]),_:1}),(0,r.bF)(A,{prop:"status",label:"交易状态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(x,{type:P.getStatusType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(P.getStatusText(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(A,{prop:"createdTime",label:"申请时间",width:"180"}),(0,r.bF)(A,{prop:"updatedTime",label:"更新时间",width:"180"}),(0,r.bF)(A,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(W,{type:"primary",size:"small",onClick:(0,s.D$)(t=>P.viewTradeDetail(e.row),["stop"]),class:"btn-view"},{default:(0,r.k6)(()=>[...t[17]||(t[17]=[(0,r.eW)(" 详情 ",-1)])]),_:1},8,["onClick"]),0===e.row.status?((0,r.uX)(),(0,r.Wv)(W,{key:0,type:"success",size:"small",onClick:(0,s.D$)(t=>P.acceptTrade(e.row),["stop"]),class:"btn-accept"},{default:(0,r.k6)(()=>[...t[18]||(t[18]=[(0,r.eW)(" 接受 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0),0===e.row.status?((0,r.uX)(),(0,r.Wv)(W,{key:1,type:"danger",size:"small",onClick:(0,s.D$)(t=>P.rejectTrade(e.row),["stop"]),class:"btn-reject"},{default:(0,r.k6)(()=>[...t[19]||(t[19]=[(0,r.eW)(" 拒绝 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["data","empty-text","onRowClick"])),[[X,_.sellerLoading]]),(0,r.Lk)("div",S,[(0,r.bF)(N,{"current-page":_.sellerCurrentPage,"onUpdate:currentPage":t[8]||(t[8]=e=>_.sellerCurrentPage=e),"page-size":_.sellerPageSize,"onUpdate:pageSize":t[9]||(t[9]=e=>_.sellerPageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:_.sellerTotal,onSizeChange:P.handleSellerSizeChange,onCurrentChange:P.handleSellerCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])]),_:1})]),_:1},8,["modelValue","onTabClick"])]),_:1}),(0,r.bF)(I,{modelValue:_.confirmDialogVisible,"onUpdate:modelValue":t[12]||(t[12]=e=>_.confirmDialogVisible=e),title:_.confirmDialogTitle,width:"30%"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",D,[(0,r.bF)(W,{onClick:t[11]||(t[11]=e=>_.confirmDialogVisible=!1)},{default:(0,r.k6)(()=>[...t[20]||(t[20]=[(0,r.eW)("取消",-1)])]),_:1}),"cancel"===_.actionType||"reject"===_.actionType?((0,r.uX)(),(0,r.Wv)(W,{key:0,type:"danger",onClick:P.confirmAction},{default:(0,r.k6)(()=>[...t[21]||(t[21]=[(0,r.eW)("确认",-1)])]),_:1},8,["onClick"])):((0,r.uX)(),(0,r.Wv)(W,{key:1,type:"success",onClick:P.confirmAction},{default:(0,r.k6)(()=>[...t[22]||(t[22]=[(0,r.eW)("确认",-1)])]),_:1},8,["onClick"]))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",null,(0,l.v_)(_.confirmDialogContent),1)]),_:1},8,["modelValue","title"])])}var _=a(552);const P={name:"UserTrades",data(){return{activeTab:"buyer",buyerTrades:[],buyerLoading:!1,buyerSearchQuery:"",buyerTradeStatus:"",buyerDateRange:null,buyerCurrentPage:1,buyerPageSize:10,buyerTotal:0,sellerTrades:[],sellerLoading:!1,sellerSearchQuery:"",sellerTradeStatus:"",sellerDateRange:null,sellerCurrentPage:1,sellerPageSize:10,sellerTotal:0,confirmDialogVisible:!1,confirmDialogTitle:"",confirmDialogContent:"",actionTrade:null,actionType:""}},computed:{filteredBuyerTrades(){let e=this.buyerTrades;this.buyerSearchQuery&&(e=e.filter(e=>e.productName.toLowerCase().includes(this.buyerSearchQuery.toLowerCase()))),""!==this.buyerTradeStatus&&(e=e.filter(e=>e.status.toString()===this.buyerTradeStatus)),this.buyerDateRange&&2===this.buyerDateRange.length&&(e=e.filter(e=>{const t=new Date(e.createdTime),a=new Date(this.buyerDateRange[0]),r=new Date(this.buyerDateRange[1]);return t>=a&&t<=r})),this.buyerTotal=e.length;const t=(this.buyerCurrentPage-1)*this.buyerPageSize,a=t+this.buyerPageSize;return e.slice(t,a)},filteredSellerTrades(){let e=this.sellerTrades;this.sellerSearchQuery&&(e=e.filter(e=>e.productName.toLowerCase().includes(this.sellerSearchQuery.toLowerCase()))),""!==this.sellerTradeStatus&&(e=e.filter(e=>e.status.toString()===this.sellerTradeStatus)),this.sellerDateRange&&2===this.sellerDateRange.length&&(e=e.filter(e=>{const t=new Date(e.createdTime),a=new Date(this.sellerDateRange[0]),r=new Date(this.sellerDateRange[1]);return t>=a&&t<=r})),this.sellerTotal=e.length;const t=(this.sellerCurrentPage-1)*this.sellerPageSize,a=t+this.sellerPageSize;return e.slice(t,a)},buyerEmptyText(){return this.buyerLoading?"加载中...":"暂无发起的交易"},sellerEmptyText(){return this.sellerLoading?"加载中...":"暂无收到的交易"}},mounted(){this.loadBuyerTrades(),this.loadSellerTrades()},watch:{buyerSearchQuery(){this.buyerCurrentPage=1},buyerTradeStatus(){this.buyerCurrentPage=1},buyerDateRange(){this.buyerCurrentPage=1},sellerSearchQuery(){this.sellerCurrentPage=1},sellerTradeStatus(){this.sellerCurrentPage=1},sellerDateRange(){this.sellerCurrentPage=1}},methods:{handleTabClick(){},async loadBuyerTrades(){this.buyerLoading=!0;try{const e=await _.Rv.getBuyerTrades();this.buyerTrades=e.map(e=>({...e,createdTime:this.formatDate(e.createdTime),updatedTime:this.formatDate(e.updatedTime)}))}catch(e){this.$message.error("加载交易记录失败"),this.buyerTrades=[]}finally{this.buyerLoading=!1}},async loadSellerTrades(){this.sellerLoading=!0;try{const e=await _.Rv.getSellerTrades();this.sellerTrades=e.map(e=>({...e,createdTime:this.formatDate(e.createdTime),updatedTime:this.formatDate(e.updatedTime)}))}catch(e){this.$message.error("加载交易记录失败"),this.sellerTrades=[]}finally{this.sellerLoading=!1}},getProductImage(e){if(!e)return"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png";const t="string"===typeof e?JSON.parse(e):e;return t&&t.length>0?t[0]:"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png"},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN")},getStatusType(e){const t={0:"warning",1:"primary",2:"info",3:"success",4:"danger"};return t[e]||"info"},getStatusText(e){const t={0:"待确认",1:"已接受",2:"已拒绝",3:"已完成",4:"已取消"};return t[e]||"未知"},viewTradeDetail(e){this.$router.push(`/trade/detail/${e.id}`)},cancelTrade(e){this.actionTrade=e,this.actionType="cancel",this.confirmDialogTitle="取消交易",this.confirmDialogContent="确定要取消该交易吗？",this.confirmDialogVisible=!0},confirmReceive(e){this.actionTrade=e,this.actionType="confirm",this.confirmDialogTitle="确认收货",this.confirmDialogContent="请确认您已收到商品，确认后交易将完成。",this.confirmDialogVisible=!0},acceptTrade(e){this.actionTrade=e,this.actionType="accept",this.confirmDialogTitle="接受交易",this.confirmDialogContent="确定要接受该交易申请吗？",this.confirmDialogVisible=!0},rejectTrade(e){this.actionTrade=e,this.actionType="reject",this.confirmDialogTitle="拒绝交易",this.confirmDialogContent="确定要拒绝该交易申请吗？",this.confirmDialogVisible=!0},async confirmAction(){this.confirmDialogVisible=!1;try{switch(this.actionType){case"cancel":await _.Rv.cancelTrade(this.actionTrade.id),this.$message.success("交易已取消"),this.loadBuyerTrades();break;case"confirm":await _.Rv.confirmReceive(this.actionTrade.id),this.$message.success("已确认收货，交易完成"),this.loadBuyerTrades();break;case"accept":await _.Rv.acceptTrade(this.actionTrade.id),this.$message.success("已接受交易"),this.loadSellerTrades();break;case"reject":await _.Rv.rejectTrade(this.actionTrade.id),this.$message.success("已拒绝交易"),this.loadSellerTrades();break}}catch(e){this.$message.error("操作失败，请重试")}},handleBuyerSizeChange(e){this.buyerPageSize=e},handleBuyerCurrentChange(e){this.buyerCurrentPage=e},handleSellerSizeChange(e){this.sellerPageSize=e},handleSellerCurrentChange(e){this.sellerCurrentPage=e}}};var z=a(262);const L=(0,z.A)(P,[["render",F],["__scopeId","data-v-390d383a"]]),V=L}}]);
//# sourceMappingURL=723.6bbfa34b.js.map