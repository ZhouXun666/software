"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[838],{552:(e,t,s)=>{s.d(t,{Eo:()=>r,Rv:()=>d,a6:()=>i});var a=s(335);const r={register:e=>a.A.post("/users/register",e),login:e=>a.A.post("/users/login",e),getCurrentUser:()=>a.A.get("/users/me"),updateUser:e=>a.A.put("/users/me",e),getUsers:e=>a.A.get("/users",{params:e})},i={createProduct:e=>a.A.post("/products",e),getProducts:e=>a.A.get("/products",{params:e}),getProductById:e=>a.A.get(`/products/${e}`),updateProduct:(e,t)=>a.A.put(`/products/${e}`,t),deleteProduct:e=>a.A.delete(`/products/${e}`),getMyProducts:()=>a.A.get("/products/my"),searchProducts:e=>a.A.get("/products/search",{params:{keyword:e}})},d={applyTrade:e=>a.A.post("/trades/apply",e),acceptTrade:e=>a.A.post(`/trades/${e}/accept`),rejectTrade:e=>a.A.post(`/trades/${e}/reject`),cancelTrade:e=>a.A.post(`/trades/${e}/cancel`),completeTrade:e=>a.A.post(`/trades/${e}/complete`),getTradeById:e=>a.A.get(`/trades/${e}`),getMyBuyTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return a.A.get(`/trades/buyer/${e?.id}`)},getMySellTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return a.A.get(`/trades/seller/${e?.id}`)},getProductTrades:e=>a.A.get(`/trades/product/${e}`)}},838:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var a=s(641),r=s(33);const i={class:"user-info-container"},d={class:"card-header"},c={key:0,class:"user-profile"},o={class:"avatar-section"},l={class:"user-name"},n={class:"user-role"},u={class:"info-section"},v={class:"stats-section"},f={class:"stats-grid"},p={class:"stat-item"},k={class:"stat-value"},g={class:"stat-item"},m={class:"stat-value"},h={class:"stat-item"},b={class:"stat-value"},_={class:"stat-item"},y={class:"stat-value"},I={class:"stat-item"},L={class:"stat-value"},T={class:"recent-activities"},A={key:0,class:"activities-list"},F={class:"activity-icon"},$={class:"activity-content"},S={class:"activity-text"},w={class:"activity-time"},P={key:1,class:"no-activities"},U={key:1,class:"loading-state"};function C(e,t,s,C,W,E){const R=(0,a.g2)("Edit"),X=(0,a.g2)("el-icon"),D=(0,a.g2)("el-button"),M=(0,a.g2)("el-avatar"),B=(0,a.g2)("el-descriptions-item"),G=(0,a.g2)("el-descriptions"),J=(0,a.g2)("Goods"),K=(0,a.g2)("Transaction"),N=(0,a.g2)("User"),j=(0,a.g2)("el-skeleton"),x=(0,a.g2)("el-card");return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.bF)(x,{class:"user-info-card"},{header:(0,a.k6)(()=>[(0,a.Lk)("div",d,[t[1]||(t[1]=(0,a.Lk)("span",null,"个人信息",-1)),(0,a.bF)(D,{type:"primary",onClick:E.goToEdit,class:"edit-btn"},{default:(0,a.k6)(()=>[(0,a.bF)(X,null,{default:(0,a.k6)(()=>[(0,a.bF)(R)]),_:1}),t[0]||(t[0]=(0,a.eW)(" 编辑资料 ",-1))]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[W.userInfo?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",o,[(0,a.bF)(M,{size:120,src:W.userInfo.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",class:"user-avatar"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(W.userInfo.username?W.userInfo.username.charAt(0).toUpperCase():"U"),1)]),_:1},8,["src"]),(0,a.Lk)("div",l,(0,r.v_)(W.userInfo.username),1),(0,a.Lk)("div",n,(0,r.v_)(E.userRole),1)]),(0,a.Lk)("div",u,[t[2]||(t[2]=(0,a.Lk)("h3",{class:"section-title"},"基本信息",-1)),(0,a.bF)(G,{border:"",column:{xs:1,sm:2}},{default:(0,a.k6)(()=>[(0,a.bF)(B,{label:"用户ID"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(W.userInfo.id||"-"),1)]),_:1}),(0,a.bF)(B,{label:"昵称"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(W.userInfo.nickname||"未设置"),1)]),_:1}),(0,a.bF)(B,{label:"性别"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(E.userGender),1)]),_:1}),(0,a.bF)(B,{label:"邮箱"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(W.userInfo.email||"未设置"),1)]),_:1}),(0,a.bF)(B,{label:"手机号码"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(W.userInfo.phone||"未设置"),1)]),_:1}),(0,a.bF)(B,{label:"个性签名"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(W.userInfo.bio||"未设置"),1)]),_:1}),(0,a.bF)(B,{label:"注册时间"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(E.formatDate(W.userInfo.createdTime)),1)]),_:1}),(0,a.bF)(B,{label:"最后登录"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(E.formatDate(W.userInfo.lastLoginTime)),1)]),_:1})]),_:1})]),(0,a.Lk)("div",v,[t[8]||(t[8]=(0,a.Lk)("h3",{class:"section-title"},"账户统计",-1)),(0,a.Lk)("div",f,[(0,a.Lk)("div",p,[(0,a.Lk)("div",k,(0,r.v_)(W.userStats.totalProducts||0),1),t[3]||(t[3]=(0,a.Lk)("div",{class:"stat-label"},"发布商品",-1))]),(0,a.Lk)("div",g,[(0,a.Lk)("div",m,(0,r.v_)(W.userStats.activeProducts||0),1),t[4]||(t[4]=(0,a.Lk)("div",{class:"stat-label"},"在售商品",-1))]),(0,a.Lk)("div",h,[(0,a.Lk)("div",b,(0,r.v_)(W.userStats.initiatedTrades||0),1),t[5]||(t[5]=(0,a.Lk)("div",{class:"stat-label"},"发起交易",-1))]),(0,a.Lk)("div",_,[(0,a.Lk)("div",y,(0,r.v_)(W.userStats.receivedTrades||0),1),t[6]||(t[6]=(0,a.Lk)("div",{class:"stat-label"},"收到交易",-1))]),(0,a.Lk)("div",I,[(0,a.Lk)("div",L,(0,r.v_)(W.userStats.completedTrades||0),1),t[7]||(t[7]=(0,a.Lk)("div",{class:"stat-label"},"完成交易",-1))])])]),(0,a.Lk)("div",T,[t[9]||(t[9]=(0,a.Lk)("h3",{class:"section-title"},"最近活动",-1)),W.recentActivities.length>0?((0,a.uX)(),(0,a.CE)("div",A,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(W.recentActivities,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"activity-item"},[(0,a.Lk)("div",F,["product"===e.type?((0,a.uX)(),(0,a.Wv)(X,{key:0},{default:(0,a.k6)(()=>[(0,a.bF)(J)]),_:1})):"trade"===e.type?((0,a.uX)(),(0,a.Wv)(X,{key:1},{default:(0,a.k6)(()=>[(0,a.bF)(K)]),_:1})):((0,a.uX)(),(0,a.Wv)(X,{key:2},{default:(0,a.k6)(()=>[(0,a.bF)(N)]),_:1}))]),(0,a.Lk)("div",$,[(0,a.Lk)("div",S,(0,r.v_)(e.description),1),(0,a.Lk)("div",w,(0,r.v_)(E.formatRelativeTime(e.time)),1)])]))),128))])):((0,a.uX)(),(0,a.CE)("div",P,"暂无活动记录"))])])):((0,a.uX)(),(0,a.CE)("div",U,[(0,a.bF)(j,{animated:"",rows:6,class:"user-skeleton"})]))]),_:1})])}var W=s(548),E=s(552);const R={name:"UserInfo",components:{Edit:W.ffu,User:W.KJW,Goods:W.BKb,Transaction:W.Transaction},data(){return{userInfo:null,userStats:{totalProducts:0,activeProducts:0,initiatedTrades:0,receivedTrades:0,completedTrades:0},recentActivities:[],loading:!0}},computed:{userRole(){return this.userInfo?this.userInfo.isAdmin?"管理员":"普通用户":""},userGender(){if(!this.userInfo||!this.userInfo.gender)return"未知";const e={1:"男",2:"女",0:"保密"};return e[this.userInfo.gender]||"未知"}},mounted(){this.loadUserInfo()},methods:{async loadUserInfo(){this.loading=!0;try{const e=await E.Eo.getUserInfo();this.userInfo=e,await this.loadUserStats(),await this.loadRecentActivities()}catch(e){this.$message.error("加载用户信息失败"),console.error("Failed to load user info:",e)}finally{this.loading=!1}},async loadUserStats(){try{const e=await E.a6.getUserProducts();this.userStats.totalProducts=e.length,this.userStats.activeProducts=e.filter(e=>1===e.status).length;const t=await E.Rv.getInitiatedTrades(),s=await E.Rv.getReceivedTrades();this.userStats.initiatedTrades=t.length,this.userStats.receivedTrades=s.length;const a=t.filter(e=>4===e.status).length,r=s.filter(e=>4===e.status).length;this.userStats.completedTrades=a+r}catch(e){console.error("Failed to load user stats:",e)}},async loadRecentActivities(){try{const e=[],t=await E.a6.getUserProducts(),s=t.slice(0,3).map(e=>({id:`product-${e.id}`,type:"product",description:`发布了商品《${e.name}》`,time:e.createdTime}));e.push(...s);const a=await E.Rv.getInitiatedTrades(),r=a.slice(0,3).map(e=>({id:`trade-${e.id}`,type:"trade",description:`发起了交易 #${e.id}`,time:e.createdTime}));e.push(...r),e.sort((e,t)=>new Date(t.time)-new Date(e.time)),this.recentActivities=e.slice(0,5)}catch(e){console.error("Failed to load recent activities:",e),this.recentActivities=[]}},formatDate(e){if(!e)return"-";const t=new Date(e);return t.toLocaleString("zh-CN")},formatRelativeTime(e){if(!e)return"";const t=new Date,s=new Date(e),a=t-s,r=6e4,i=60*r,d=24*i,c=7*d,o=30*d;return a<r?"刚刚":a<i?`${Math.floor(a/r)}分钟前`:a<d?`${Math.floor(a/i)}小时前`:a<c?`${Math.floor(a/d)}天前`:a<o?`${Math.floor(a/c)}周前`:`${Math.floor(a/o)}个月前`},goToEdit(){this.$router.push("/user/update")}}};var X=s(262);const D=(0,X.A)(R,[["render",C],["__scopeId","data-v-a2e0a7a2"]]),M=D}}]);
//# sourceMappingURL=838.65a9a46e.js.map