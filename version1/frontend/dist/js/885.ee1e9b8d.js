"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[885],{552:(e,t,s)=>{s.d(t,{Eo:()=>r,Rv:()=>c,a6:()=>i});var a=s(335);const r={register:e=>a.A.post("/users/register",e),login:e=>a.A.post("/users/login",e),getCurrentUser:()=>a.A.get("/users/me"),updateUser:e=>a.A.put("/users/me",e),getUsers:e=>a.A.get("/users",{params:e})},i={createProduct:e=>a.A.post("/products",e),getProducts:e=>a.A.get("/products",{params:e}),getProductById:e=>a.A.get(`/products/${e}`),updateProduct:(e,t)=>a.A.put(`/products/${e}`,t),deleteProduct:e=>a.A.delete(`/products/${e}`),getMyProducts:()=>a.A.get("/products/my"),searchProducts:e=>a.A.get("/products/search",{params:{keyword:e}})},c={applyTrade:e=>a.A.post("/trades/apply",e),acceptTrade:e=>a.A.post(`/trades/${e}/accept`),rejectTrade:e=>a.A.post(`/trades/${e}/reject`),cancelTrade:e=>a.A.post(`/trades/${e}/cancel`),completeTrade:e=>a.A.post(`/trades/${e}/complete`),getTradeById:e=>a.A.get(`/trades/${e}`),getMyBuyTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return a.A.get(`/trades/buyer/${e?.id}`)},getMySellTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return a.A.get(`/trades/seller/${e?.id}`)},getProductTrades:e=>a.A.get(`/trades/product/${e}`)}},885:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ie});var a=s(641),r=s(33);const i={class:"trade-detail-container"},c={key:0,class:"loading"},n={class:"card-header"},l={class:"status-overview"},o={class:"detail-content"},d={class:"product-info"},u=["src"],g={class:"product-details"},m={class:"product-name"},p={class:"product-price"},k={class:"product-category"},f={class:"product-description"},v={class:"trade-parties"},h={class:"parties-info"},y={class:"party-item"},b={class:"party-content"},L={class:"party-details"},_={class:"party-name"},C={class:"party-contact"},A={class:"party-item"},T={class:"party-content"},F={class:"party-details"},I={class:"party-name"},D={class:"party-contact"},w={class:"trade-info"},$={class:"info-row"},S={class:"info-value"},X={class:"info-row"},M={class:"info-value"},V={class:"info-row"},W={class:"info-value"},E={key:0,class:"info-row"},x={class:"info-value"},R={key:1,class:"info-row"},U={class:"info-value"},j={key:2,class:"info-row"},N={class:"info-value"},B={key:3,class:"info-row"},O={class:"info-value"},P={class:"messages-section"},z={key:0,class:"messages-list"},Q={class:"message-header"},q={class:"message-sender"},J={class:"message-time"},H={class:"message-content"},K={key:1,class:"no-messages"},G={key:0,class:"action-buttons"},Y={key:2,class:"not-found"},Z={class:"dialog-footer"};function ee(e,t,s,ee,te,se){const ae=(0,a.g2)("el-spinner"),re=(0,a.g2)("el-button"),ie=(0,a.g2)("el-step"),ce=(0,a.g2)("el-steps"),ne=(0,a.g2)("el-tag"),le=(0,a.g2)("el-card"),oe=(0,a.g2)("el-avatar"),de=(0,a.g2)("el-input"),ue=(0,a.g2)("el-form-item"),ge=(0,a.g2)("el-form"),me=(0,a.g2)("el-empty"),pe=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",i,[te.loading?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.bF)(ae,{type:"spinner"}),t[3]||(t[3]=(0,a.Lk)("p",null,"加载中...",-1))])):te.trade?((0,a.uX)(),(0,a.Wv)(le,{key:1,class:"detail-card"},{header:(0,a.k6)(()=>[(0,a.Lk)("div",n,[t[5]||(t[5]=(0,a.Lk)("span",null,"交易详情",-1)),(0,a.bF)(re,{type:"primary",size:"small",onClick:se.goBack,class:"back-btn"},{default:(0,a.k6)(()=>[...t[4]||(t[4]=[(0,a.eW)(" 返回列表 ",-1)])]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",l,[(0,a.bF)(ce,{active:se.tradeStatusStep,"finish-status":"success","align-center":""},{default:(0,a.k6)(()=>[(0,a.bF)(ie,{title:"交易申请",description:"买家发起交易申请"}),(0,a.bF)(ie,{title:"卖家确认",description:"卖家接受或拒绝交易"}),(0,a.bF)(ie,{title:"交易完成",description:"买家确认收货"})]),_:1},8,["active"]),(0,a.bF)(ne,{type:se.getStatusType(te.trade.status),class:"status-tag"},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(se.getStatusText(te.trade.status)),1)]),_:1},8,["type"])]),(0,a.Lk)("div",o,[(0,a.bF)(le,{class:"info-section"},{header:(0,a.k6)(()=>[...t[6]||(t[6]=[(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("span",null,"商品信息")],-1)])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",d,[(0,a.Lk)("img",{src:se.getProductImage(te.trade.product.images),class:"product-image"},null,8,u),(0,a.Lk)("div",g,[(0,a.Lk)("h3",m,(0,r.v_)(te.trade.product.name),1),(0,a.Lk)("p",p,"¥"+(0,r.v_)(te.trade.product.price),1),(0,a.Lk)("p",k,"分类："+(0,r.v_)(se.getCategoryName(te.trade.product.categoryId)),1),(0,a.Lk)("p",f,(0,r.v_)(te.trade.product.description),1)])])]),_:1}),(0,a.Lk)("div",v,[(0,a.bF)(le,{class:"info-section"},{header:(0,a.k6)(()=>[...t[7]||(t[7]=[(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("span",null,"交易方信息")],-1)])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",h,[(0,a.Lk)("div",y,[t[8]||(t[8]=(0,a.Lk)("div",{class:"party-label"},"买家",-1)),(0,a.Lk)("div",b,[(0,a.bF)(oe,{size:40,src:te.buyerInfo.avatar||te.defaultAvatar},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(se.getUserInitial(te.buyerInfo.username)),1)]),_:1},8,["src"]),(0,a.Lk)("div",L,[(0,a.Lk)("div",_,(0,r.v_)(te.buyerInfo.username),1),(0,a.Lk)("div",C,"联系方式："+(0,r.v_)(te.buyerInfo.contact||"未提供"),1)])])]),(0,a.Lk)("div",A,[t[9]||(t[9]=(0,a.Lk)("div",{class:"party-label"},"卖家",-1)),(0,a.Lk)("div",T,[(0,a.bF)(oe,{size:40,src:te.sellerInfo.avatar||te.defaultAvatar},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(se.getUserInitial(te.sellerInfo.username)),1)]),_:1},8,["src"]),(0,a.Lk)("div",F,[(0,a.Lk)("div",I,(0,r.v_)(te.sellerInfo.username),1),(0,a.Lk)("div",D,"联系方式："+(0,r.v_)(te.sellerInfo.contact||"未提供"),1)])])])])]),_:1})]),(0,a.bF)(le,{class:"info-section"},{header:(0,a.k6)(()=>[...t[10]||(t[10]=[(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("span",null,"交易信息")],-1)])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",w,[(0,a.Lk)("div",$,[t[11]||(t[11]=(0,a.Lk)("div",{class:"info-label"},"交易ID：",-1)),(0,a.Lk)("div",S,(0,r.v_)(te.trade.id),1)]),(0,a.Lk)("div",X,[t[12]||(t[12]=(0,a.Lk)("div",{class:"info-label"},"创建时间：",-1)),(0,a.Lk)("div",M,(0,r.v_)(se.formatDate(te.trade.createdTime)),1)]),(0,a.Lk)("div",V,[t[13]||(t[13]=(0,a.Lk)("div",{class:"info-label"},"更新时间：",-1)),(0,a.Lk)("div",W,(0,r.v_)(se.formatDate(te.trade.updatedTime)),1)]),1===te.trade.status||3===te.trade.status?((0,a.uX)(),(0,a.CE)("div",E,[t[14]||(t[14]=(0,a.Lk)("div",{class:"info-label"},"接受时间：",-1)),(0,a.Lk)("div",x,(0,r.v_)(se.formatDate(te.trade.acceptTime)),1)])):(0,a.Q3)("",!0),2===te.trade.status?((0,a.uX)(),(0,a.CE)("div",R,[t[15]||(t[15]=(0,a.Lk)("div",{class:"info-label"},"拒绝时间：",-1)),(0,a.Lk)("div",U,(0,r.v_)(se.formatDate(te.trade.rejectTime)),1)])):(0,a.Q3)("",!0),3===te.trade.status?((0,a.uX)(),(0,a.CE)("div",j,[t[16]||(t[16]=(0,a.Lk)("div",{class:"info-label"},"完成时间：",-1)),(0,a.Lk)("div",N,(0,r.v_)(se.formatDate(te.trade.completeTime)),1)])):(0,a.Q3)("",!0),4===te.trade.status?((0,a.uX)(),(0,a.CE)("div",B,[t[17]||(t[17]=(0,a.Lk)("div",{class:"info-label"},"取消时间：",-1)),(0,a.Lk)("div",O,(0,r.v_)(se.formatDate(te.trade.cancelTime)),1)])):(0,a.Q3)("",!0)])]),_:1}),(0,a.bF)(le,{class:"info-section"},{header:(0,a.k6)(()=>[...t[18]||(t[18]=[(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("span",null,"交易留言")],-1)])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",P,[te.tradeMessages.length>0?((0,a.uX)(),(0,a.CE)("div",z,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(te.tradeMessages,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"message-item"},[(0,a.Lk)("div",Q,[(0,a.Lk)("div",q,(0,r.v_)("buyer"===e.sender?"买家":"卖家"),1),(0,a.Lk)("div",J,(0,r.v_)(se.formatDate(e.createdTime)),1)]),(0,a.Lk)("div",H,(0,r.v_)(e.content),1)]))),128))])):((0,a.uX)(),(0,a.CE)("div",K,"暂无交易留言")),se.canSendMessage?((0,a.uX)(),(0,a.Wv)(ge,{key:2,model:te.messageForm,rules:te.messageRules,ref:"messageFormRef",class:"message-form"},{default:(0,a.k6)(()=>[(0,a.bF)(ue,{prop:"content"},{default:(0,a.k6)(()=>[(0,a.bF)(de,{modelValue:te.messageForm.content,"onUpdate:modelValue":t[0]||(t[0]=e=>te.messageForm.content=e),type:"textarea",rows:3,placeholder:"输入留言内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,a.bF)(ue,null,{default:(0,a.k6)(()=>[(0,a.bF)(re,{type:"primary",onClick:se.sendMessage,loading:te.sendingMessage},{default:(0,a.k6)(()=>[...t[19]||(t[19]=[(0,a.eW)("发送留言",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])):(0,a.Q3)("",!0)])]),_:1}),se.actionButtons.length>0?((0,a.uX)(),(0,a.CE)("div",G,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(se.actionButtons,e=>((0,a.uX)(),(0,a.Wv)(re,{key:e.key,type:e.type,size:e.size||"large",loading:"sending"===e.key&&te.sendingAction,onClick:t=>se.handleAction(e.action),class:(0,r.C4)(e.class)},{default:(0,a.k6)(()=>[(0,a.eW)((0,r.v_)(e.text),1)]),_:2},1032,["type","size","loading","onClick","class"]))),128))])):(0,a.Q3)("",!0)])]),_:1})):((0,a.uX)(),(0,a.CE)("div",Y,[(0,a.bF)(me,{description:"交易不存在或已删除"}),(0,a.bF)(re,{type:"primary",onClick:se.goBack},{default:(0,a.k6)(()=>[...t[20]||(t[20]=[(0,a.eW)("返回",-1)])]),_:1},8,["onClick"])])),(0,a.bF)(pe,{modelValue:te.confirmDialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>te.confirmDialogVisible=e),title:te.confirmDialogTitle,width:"30%"},{footer:(0,a.k6)(()=>[(0,a.Lk)("span",Z,[(0,a.bF)(re,{onClick:t[1]||(t[1]=e=>te.confirmDialogVisible=!1)},{default:(0,a.k6)(()=>[...t[21]||(t[21]=[(0,a.eW)("取消",-1)])]),_:1}),"cancel"===te.actionType||"reject"===te.actionType?((0,a.uX)(),(0,a.Wv)(re,{key:0,type:"danger",onClick:se.confirmAction},{default:(0,a.k6)(()=>[...t[22]||(t[22]=[(0,a.eW)("确认",-1)])]),_:1},8,["onClick"])):((0,a.uX)(),(0,a.Wv)(re,{key:1,type:"success",onClick:se.confirmAction},{default:(0,a.k6)(()=>[...t[23]||(t[23]=[(0,a.eW)("确认",-1)])]),_:1},8,["onClick"]))])]),default:(0,a.k6)(()=>[(0,a.Lk)("div",null,(0,r.v_)(te.confirmDialogContent),1)]),_:1},8,["modelValue","title"])])}var te=s(552);const se={name:"TradeDetail",data(){return{trade:null,loading:!1,buyerInfo:{},sellerInfo:{},tradeMessages:[],defaultAvatar:"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png",messageForm:{content:""},messageRules:{content:[{required:!0,message:"请输入留言内容",trigger:"blur"},{max:500,message:"留言内容不能超过500个字符",trigger:"blur"}]},sendingMessage:!1,sendingAction:!1,confirmDialogVisible:!1,confirmDialogTitle:"",confirmDialogContent:"",actionType:""}},computed:{tradeStatusStep(){switch(this.trade?.status){case 0:return 0;case 1:return 1;case 2:return 1;case 3:return 2;case 4:return 1;default:return 0}},canSendMessage(){return this.trade&&(0===this.trade.status||1===this.trade.status)},actionButtons(){if(!this.trade)return[];const e=[],t=JSON.parse(localStorage.getItem("userInfo"))?.id;return t===this.trade.buyerId&&(0===this.trade.status&&e.push({key:"cancel",text:"取消交易",type:"danger",action:"cancel"}),1===this.trade.status&&e.push({key:"confirm",text:"确认收货",type:"success",action:"confirm"})),t===this.trade.sellerId&&0===this.trade.status&&(e.push({key:"accept",text:"接受交易",type:"success",class:"mr-2",action:"accept"}),e.push({key:"reject",text:"拒绝交易",type:"danger",action:"reject"})),e}},mounted(){this.loadTradeDetail()},methods:{async loadTradeDetail(){const e=this.$route.params.id;this.loading=!0;try{const t=await te.Rv.getTradeById(e);this.trade=t,this.buyerInfo={username:t.buyerName,avatar:t.buyerAvatar,contact:t.buyerContact},this.sellerInfo={username:t.sellerName,avatar:t.sellerAvatar,contact:t.sellerContact},t.messages&&(this.tradeMessages=t.messages)}catch(t){this.$message.error("加载交易详情失败"),this.trade=null}finally{this.loading=!1}},getProductImage(e){if(!e)return"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png";const t="string"===typeof e?JSON.parse(e):e;return t&&t.length>0?t[0]:"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png"},getCategoryName(e){const t={1:"电子产品",2:"图书文具",3:"服装鞋帽",4:"生活用品",5:"其他"};return t[e]||"未知"},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN")},getUserInitial(e){return e?e.charAt(0).toUpperCase():"U"},getStatusType(e){const t={0:"warning",1:"primary",2:"info",3:"success",4:"danger"};return t[e]||"info"},getStatusText(e){const t={0:"待确认",1:"已接受",2:"已拒绝",3:"已完成",4:"已取消"};return t[e]||"未知"},handleAction(e){switch(this.actionType=e,e){case"cancel":this.confirmDialogTitle="取消交易",this.confirmDialogContent="确定要取消该交易吗？";break;case"confirm":this.confirmDialogTitle="确认收货",this.confirmDialogContent="请确认您已收到商品，确认后交易将完成。";break;case"accept":this.confirmDialogTitle="接受交易",this.confirmDialogContent="确定要接受该交易申请吗？";break;case"reject":this.confirmDialogTitle="拒绝交易",this.confirmDialogContent="确定要拒绝该交易申请吗？";break}this.confirmDialogVisible=!0},async confirmAction(){this.confirmDialogVisible=!1,this.sendingAction=!0;try{switch(this.actionType){case"cancel":await te.Rv.cancelTrade(this.trade.id),this.$message.success("交易已取消");break;case"confirm":await te.Rv.confirmReceive(this.trade.id),this.$message.success("已确认收货，交易完成");break;case"accept":await te.Rv.acceptTrade(this.trade.id),this.$message.success("已接受交易");break;case"reject":await te.Rv.rejectTrade(this.trade.id),this.$message.success("已拒绝交易");break}this.loadTradeDetail()}catch(e){this.$message.error("操作失败，请重试")}finally{this.sendingAction=!1}},async sendMessage(){this.$refs.messageFormRef.validate(async e=>{if(e){this.sendingMessage=!0;try{const e=await te.Rv.sendMessage(this.trade.id,{content:this.messageForm.content});this.tradeMessages.push(e),this.messageForm.content="",this.$refs.messageFormRef.resetFields(),this.$message.success("留言发送成功")}catch(t){this.$message.error("留言发送失败，请重试")}finally{this.sendingMessage=!1}}})},goBack(){this.$router.push("/user/trades")}}};var ae=s(262);const re=(0,ae.A)(se,[["render",ee],["__scopeId","data-v-344e78d2"]]),ie=re}}]);
//# sourceMappingURL=885.ee1e9b8d.js.map