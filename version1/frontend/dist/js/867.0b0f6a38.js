"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[867],{248:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(641),s=a(33);const d={class:"trade-list-container"},l={class:"search-filter"},o={class:"product-info"},c=["src"],u={class:"product-details"},n={class:"product-name"},i={class:"product-price"},p={class:"pagination-container"};function g(e,t,a,g,h,m){const b=(0,r.g2)("el-input"),y=(0,r.g2)("el-option"),f=(0,r.g2)("el-select"),k=(0,r.g2)("el-date-picker"),v=(0,r.g2)("el-table-column"),w=(0,r.g2)("el-tag"),S=(0,r.g2)("el-button"),T=(0,r.g2)("el-table"),C=(0,r.g2)("el-pagination"),A=(0,r.g2)("el-card"),F=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(A,{class:"trade-card"},{header:(0,r.k6)(()=>[...t[5]||(t[5]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"交易列表")],-1)])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",l,[(0,r.bF)(b,{modelValue:h.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>h.searchQuery=e),placeholder:"搜索交易编号或商品名称","prefix-icon":"el-icon-search",class:"search-input",clearable:""},null,8,["modelValue"]),(0,r.bF)(f,{modelValue:h.tradeStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>h.tradeStatus=e),placeholder:"交易状态",clearable:"",class:"status-select"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{label:"全部",value:""}),(0,r.bF)(y,{label:"待接受",value:"1"}),(0,r.bF)(y,{label:"已接受",value:"2"}),(0,r.bF)(y,{label:"交易中",value:"3"}),(0,r.bF)(y,{label:"已完成",value:"4"}),(0,r.bF)(y,{label:"已取消",value:"5"}),(0,r.bF)(y,{label:"已拒绝",value:"6"})]),_:1},8,["modelValue"]),(0,r.bF)(k,{modelValue:h.dateRange,"onUpdate:modelValue":t[2]||(t[2]=e=>h.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:"",class:"date-picker"},null,8,["modelValue"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(T,{data:m.filteredTrades,style:{width:"100%"},"empty-text":m.emptyText},{default:(0,r.k6)(()=>[(0,r.bF)(v,{prop:"id",label:"交易编号",width:"120"}),(0,r.bF)(v,{prop:"productName",label:"商品信息","min-width":"200"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",o,[(0,r.Lk)("img",{src:m.getProductImage(e.row.product),class:"product-thumbnail"},null,8,c),(0,r.Lk)("div",u,[(0,r.Lk)("div",n,(0,s.v_)(e.row.productName),1),(0,r.Lk)("div",i,"¥"+(0,s.v_)(e.row.price),1)])])]),_:1}),(0,r.bF)(v,{prop:"buyerName",label:"买家",width:"120"},{default:(0,r.k6)(e=>[(0,r.Lk)("span",null,(0,s.v_)(e.row.buyerName||"未知买家"),1)]),_:1}),(0,r.bF)(v,{prop:"sellerName",label:"卖家",width:"120"},{default:(0,r.k6)(e=>[(0,r.Lk)("span",null,(0,s.v_)(e.row.sellerName||"未知卖家"),1)]),_:1}),(0,r.bF)(v,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(w,{type:m.getStatusType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,s.v_)(m.getStatusText(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(v,{prop:"createdTime",label:"创建时间",width:"180"}),(0,r.bF)(v,{prop:"updatedTime",label:"更新时间",width:"180"}),(0,r.bF)(v,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(S,{type:"primary",size:"small",onClick:t=>m.viewTrade(e.row.id)},{default:(0,r.k6)(()=>[...t[6]||(t[6]=[(0,r.eW)(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[F,h.loading]]),(0,r.Lk)("div",p,[(0,r.bF)(C,{"current-page":h.currentPage,"onUpdate:currentPage":t[3]||(t[3]=e=>h.currentPage=e),"page-size":h.pageSize,"onUpdate:pageSize":t[4]||(t[4]=e=>h.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:h.total,onSizeChange:m.handleSizeChange,onCurrentChange:m.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1})])}var h=a(552);const m={name:"TradeList",data(){return{trades:[],loading:!1,searchQuery:"",tradeStatus:"",dateRange:[],currentPage:1,pageSize:10,total:0,productCache:{}}},computed:{filteredTrades(){let e=this.trades;if(this.searchQuery&&(e=e.filter(e=>e.id.toString().includes(this.searchQuery)||e.productName.toLowerCase().includes(this.searchQuery.toLowerCase()))),""!==this.tradeStatus&&(e=e.filter(e=>e.status.toString()===this.tradeStatus)),this.dateRange&&2===this.dateRange.length){const[t,a]=this.dateRange;e=e.filter(e=>{const r=new Date(e.createdTime);return r>=t&&r<=a})}this.total=e.length;const t=(this.currentPage-1)*this.pageSize,a=t+this.pageSize;return e.slice(t,a)},emptyText(){return this.loading?"加载中...":"暂无交易记录"}},mounted(){this.loadTrades()},watch:{searchQuery(){this.currentPage=1},tradeStatus(){this.currentPage=1},dateRange(){this.currentPage=1}},methods:{async loadTrades(){this.loading=!0;try{const e=await h.Rv.getAllTrades();this.trades=e.map(async e=>{if(e.productId&&!this.productCache[e.productId])try{const t=await h.a6.getProduct(e.productId);this.productCache[e.productId]=t}catch(a){console.error("Failed to load product details:",a),this.productCache[e.productId]={name:"未知商品",images:[]}}const t=this.productCache[e.productId]||{name:"未知商品",images:[]};return{...e,productName:t.name,product:t,createdTime:this.formatDate(e.createdTime),updatedTime:this.formatDate(e.updatedTime)}}),this.trades=await Promise.all(this.trades)}catch(e){this.$message.error("加载交易列表失败"),this.trades=[]}finally{this.loading=!1}},getProductImage(e){if(!e||!e.images)return"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png";const t="string"===typeof e.images?JSON.parse(e.images):e.images;return t&&t.length>0?t[0]:"https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png"},getStatusType(e){const t={1:"info",2:"primary",3:"warning",4:"success",5:"danger",6:"danger"};return t[e]||"default"},getStatusText(e){const t={1:"待接受",2:"已接受",3:"交易中",4:"已完成",5:"已取消",6:"已拒绝"};return t[e]||"未知"},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN")},viewTrade(e){this.$router.push(`/trade/${e}`)},handleSizeChange(e){this.pageSize=e},handleCurrentChange(e){this.currentPage=e}}};var b=a(262);const y=(0,b.A)(m,[["render",g],["__scopeId","data-v-4607cb78"]]),f=y},552:(e,t,a)=>{a.d(t,{Eo:()=>s,Rv:()=>l,a6:()=>d});var r=a(335);const s={register:e=>r.A.post("/users/register",e),login:e=>r.A.post("/users/login",e),getCurrentUser:()=>r.A.get("/users/me"),updateUser:e=>r.A.put("/users/me",e),getUsers:e=>r.A.get("/users",{params:e})},d={createProduct:e=>r.A.post("/products",e),getProducts:e=>r.A.get("/products",{params:e}),getProductById:e=>r.A.get(`/products/${e}`),updateProduct:(e,t)=>r.A.put(`/products/${e}`,t),deleteProduct:e=>r.A.delete(`/products/${e}`),getMyProducts:()=>r.A.get("/products/my"),searchProducts:e=>r.A.get("/products/search",{params:{keyword:e}})},l={applyTrade:e=>r.A.post("/trades/apply",e),acceptTrade:e=>r.A.post(`/trades/${e}/accept`),rejectTrade:e=>r.A.post(`/trades/${e}/reject`),cancelTrade:e=>r.A.post(`/trades/${e}/cancel`),completeTrade:e=>r.A.post(`/trades/${e}/complete`),getTradeById:e=>r.A.get(`/trades/${e}`),getMyBuyTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return r.A.get(`/trades/buyer/${e?.id}`)},getMySellTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return r.A.get(`/trades/seller/${e?.id}`)},getProductTrades:e=>r.A.get(`/trades/product/${e}`)}}}]);
//# sourceMappingURL=867.0b0f6a38.js.map