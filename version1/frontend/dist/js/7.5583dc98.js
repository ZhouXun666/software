"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[7],{7:(t,e,a)=>{a.r(e),a.d(e,{default:()=>F});var r=a(641),s=a(33);const c={class:"product-detail-container"},d={key:0,class:"loading"},o={key:1,class:"product-detail"},u={class:"product-main"},i={class:"product-images"},n=["src","alt"],l={class:"product-info"},p={class:"product-title"},g={class:"product-price"},h={class:"product-meta"},m={class:"meta-item"},y={class:"meta-value"},k={class:"meta-item"},v={class:"meta-value"},f={class:"meta-item"},T={class:"meta-value"},$={class:"product-seller"},b={class:"seller-info"},P={class:"seller-name"},w={class:"product-actions"},_={class:"product-description"},A={key:0,class:"empty-message"},C={key:2,class:"not-found"};function L(t,e,a,L,S,I){const W=(0,r.g2)("el-spinner"),B=(0,r.g2)("el-carousel-item"),F=(0,r.g2)("el-carousel"),M=(0,r.g2)("el-avatar"),X=(0,r.g2)("el-button"),x=(0,r.g2)("el-card"),D=(0,r.g2)("el-table-column"),U=(0,r.g2)("el-tag"),E=(0,r.g2)("el-table"),N=(0,r.g2)("el-empty");return(0,r.uX)(),(0,r.CE)("div",c,[S.loading?((0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(W,{type:"spinner"}),e[0]||(e[0]=(0,r.Lk)("p",null,"加载中...",-1))])):S.product?((0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",u,[(0,r.Lk)("div",i,[(0,r.bF)(F,{interval:4e3,type:"card",height:"400px","indicator-position":"outside"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(I.getImagesArray(S.product.images),(t,e)=>((0,r.uX)(),(0,r.Wv)(B,{key:e},{default:(0,r.k6)(()=>[(0,r.Lk)("img",{src:t,alt:S.product.name+"-"+(e+1)},null,8,n)]),_:2},1024))),128))]),_:1})]),(0,r.Lk)("div",l,[(0,r.Lk)("h1",p,(0,s.v_)(S.product.name),1),(0,r.Lk)("div",g,"¥"+(0,s.v_)(S.product.price),1),(0,r.Lk)("div",h,[(0,r.Lk)("div",m,[e[1]||(e[1]=(0,r.Lk)("span",{class:"meta-label"},"分类：",-1)),(0,r.Lk)("span",y,(0,s.v_)(I.getCategoryName(S.product.categoryId)),1)]),(0,r.Lk)("div",k,[e[2]||(e[2]=(0,r.Lk)("span",{class:"meta-label"},"发布时间：",-1)),(0,r.Lk)("span",v,(0,s.v_)(I.formatDate(S.product.createTime)),1)]),(0,r.Lk)("div",f,[e[3]||(e[3]=(0,r.Lk)("span",{class:"meta-label"},"浏览次数：",-1)),(0,r.Lk)("span",T,(0,s.v_)(S.product.viewCount||0),1)])]),(0,r.Lk)("div",$,[(0,r.bF)(M,{size:40,src:S.product.userAvatar||""},{default:(0,r.k6)(()=>[(0,r.eW)((0,s.v_)(S.product.username?.charAt(0)),1)]),_:1},8,["src"]),(0,r.Lk)("div",b,[(0,r.Lk)("div",P,(0,s.v_)(S.product.username||"用户"),1),(0,r.bF)(X,{type:"primary",size:"small",onClick:I.contactSeller},{default:(0,r.k6)(()=>[...e[4]||(e[4]=[(0,r.eW)("联系卖家",-1)])]),_:1},8,["onClick"])])]),(0,r.Lk)("div",w,[I.canBuy?((0,r.uX)(),(0,r.Wv)(X,{key:0,type:"primary",size:"large",onClick:I.handleTrade,loading:S.trading,class:"action-btn"},{default:(0,r.k6)(()=>[...e[5]||(e[5]=[(0,r.eW)(" 申请交易 ",-1)])]),_:1},8,["onClick","loading"])):I.isMyProduct?((0,r.uX)(),(0,r.Wv)(X,{key:1,type:"success",size:"large",onClick:I.editProduct,class:"action-btn"},{default:(0,r.k6)(()=>[...e[6]||(e[6]=[(0,r.eW)(" 编辑商品 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0),I.isMyProduct?((0,r.uX)(),(0,r.Wv)(X,{key:2,type:"danger",size:"large",onClick:I.deleteProduct,class:"action-btn"},{default:(0,r.k6)(()=>[...e[7]||(e[7]=[(0,r.eW)(" 删除商品 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)])])]),(0,r.bF)(x,{class:"description-card"},{header:(0,r.k6)(()=>[...e[8]||(e[8]=[(0,r.Lk)("div",{class:"card-header"},"商品描述",-1)])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",_,(0,s.v_)(S.product.description),1)]),_:1}),I.isMyProduct?((0,r.uX)(),(0,r.Wv)(x,{key:0,class:"trades-card"},{header:(0,r.k6)(()=>[...e[9]||(e[9]=[(0,r.Lk)("div",{class:"card-header"},"交易记录",-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(E,{data:S.productTrades,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(D,{prop:"buyerName",label:"买家",width:"120"}),(0,r.bF)(D,{prop:"message",label:"留言"}),(0,r.bF)(D,{prop:"statusText",label:"状态",width:"100"},{default:(0,r.k6)(({row:t})=>[(0,r.bF)(U,{type:I.getStatusType(t.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,s.v_)(t.statusText),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(D,{prop:"createTime",label:"申请时间",width:"180",formatter:I.formatDateTime},null,8,["formatter"]),I.showActions?((0,r.uX)(),(0,r.Wv)(D,{key:0,label:"操作",width:"200"},{default:(0,r.k6)(({row:t})=>[0===t.status?((0,r.uX)(),(0,r.Wv)(X,{key:0,type:"primary",size:"small",onClick:e=>I.acceptTrade(t.id)},{default:(0,r.k6)(()=>[...e[10]||(e[10]=[(0,r.eW)("接受",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0),0===t.status?((0,r.uX)(),(0,r.Wv)(X,{key:1,type:"danger",size:"small",onClick:e=>I.rejectTrade(t.id)},{default:(0,r.k6)(()=>[...e[11]||(e[11]=[(0,r.eW)("拒绝",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["data"]),0===S.productTrades.length?((0,r.uX)(),(0,r.CE)("div",A,"暂无交易记录")):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",C,[(0,r.bF)(N,{description:"商品不存在或已下架"}),(0,r.bF)(X,{type:"primary",onClick:I.goBack},{default:(0,r.k6)(()=>[...e[12]||(e[12]=[(0,r.eW)("返回首页",-1)])]),_:1},8,["onClick"])]))])}var S=a(552);const I={name:"ProductDetail",data(){return{product:null,productTrades:[],loading:!1,trading:!1,currentUser:null}},computed:{canBuy(){return this.currentUser&&!this.isMyProduct&&1===this.product?.status},isMyProduct(){return this.currentUser&&this.product&&this.product.userId===this.currentUser.id},showActions(){return this.isMyProduct}},mounted(){this.currentUser=JSON.parse(localStorage.getItem("userInfo")),this.loadProductDetail()},methods:{async loadProductDetail(){const t=this.$route.params.id;this.loading=!0;try{const e=await S.a6.getProductById(t);this.product=e,this.isMyProduct&&await this.loadProductTrades()}catch(e){this.$message.error("加载商品详情失败"),this.product=null}finally{this.loading=!1}},async loadProductTrades(){try{const t=await S.Rv.getProductTrades(this.product.id);this.productTrades=t}catch(t){console.error("加载交易记录失败",t)}},getImagesArray(t){return t?"string"===typeof t?JSON.parse(t):t:["https://via.placeholder.com/400x300?text=No+Image"]},getCategoryName(t){const e={1:"电子产品",2:"图书文具",3:"服装鞋帽",4:"生活用品",5:"其他"};return e[t]||"未分类"},formatDate(t){if(!t)return"";const e=new Date(t);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`},formatDateTime(t){if(!t)return"";const e=new Date(t);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},contactSeller(){this.$message.info("请通过电话或线下方式联系卖家")},async handleTrade(){this.$prompt("请输入交易留言（选填）","申请交易",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入您的交易留言...",inputPattern:/^.{0,200}$/,inputErrorMessage:"留言最多200个字符"}).then(async({value:t})=>{this.trading=!0;try{const e={productId:this.product.id,buyerId:this.currentUser.id,message:t||""};await S.Rv.applyTrade(e),this.$message.success("交易申请已提交，请等待卖家确认"),this.$router.push("/user/trades")}catch(e){this.$message.error(e.response?.data?.message||"申请交易失败")}finally{this.trading=!1}}).catch(()=>{})},editProduct(){this.$router.push(`/product/update/${this.product.id}`)},async deleteProduct(){this.$confirm("确定要删除这个商品吗？删除后不可恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",danger:!0}).then(async()=>{try{await S.a6.deleteProduct(this.product.id),this.$message.success("商品删除成功"),this.$router.push("/user/products")}catch(t){this.$message.error("删除失败")}}).catch(()=>{})},async acceptTrade(t){this.$confirm("确定要接受这个交易吗？接受后商品将自动下架。","接受交易",{confirmButtonText:"确定",cancelButtonText:"取消",type:"primary"}).then(async()=>{try{await S.Rv.acceptTrade(t),this.$message.success("交易已接受"),await this.loadProductTrades(),await this.loadProductDetail()}catch(e){this.$message.error("操作失败")}}).catch(()=>{})},async rejectTrade(t){this.$confirm("确定要拒绝这个交易吗？","拒绝交易",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await S.Rv.rejectTrade(t),this.$message.success("交易已拒绝"),await this.loadProductTrades()}catch(e){this.$message.error("操作失败")}}).catch(()=>{})},getStatusType(t){switch(t){case 0:return"info";case 1:return"success";case 2:return"danger";case 3:return"primary";case 4:return"warning";default:return"default"}},goBack(){this.$router.push("/")}}};var W=a(262);const B=(0,W.A)(I,[["render",L],["__scopeId","data-v-01dda5c8"]]),F=B},552:(t,e,a)=>{a.d(e,{Eo:()=>s,Rv:()=>d,a6:()=>c});var r=a(335);const s={register:t=>r.A.post("/users/register",t),login:t=>r.A.post("/users/login",t),getCurrentUser:()=>r.A.get("/users/me"),updateUser:t=>r.A.put("/users/me",t),getUsers:t=>r.A.get("/users",{params:t})},c={createProduct:t=>r.A.post("/products",t),getProducts:t=>r.A.get("/products",{params:t}),getProductById:t=>r.A.get(`/products/${t}`),updateProduct:(t,e)=>r.A.put(`/products/${t}`,e),deleteProduct:t=>r.A.delete(`/products/${t}`),getMyProducts:()=>r.A.get("/products/my"),searchProducts:t=>r.A.get("/products/search",{params:{keyword:t}})},d={applyTrade:t=>r.A.post("/trades/apply",t),acceptTrade:t=>r.A.post(`/trades/${t}/accept`),rejectTrade:t=>r.A.post(`/trades/${t}/reject`),cancelTrade:t=>r.A.post(`/trades/${t}/cancel`),completeTrade:t=>r.A.post(`/trades/${t}/complete`),getTradeById:t=>r.A.get(`/trades/${t}`),getMyBuyTrades:()=>{const t=JSON.parse(localStorage.getItem("userInfo"));return r.A.get(`/trades/buyer/${t?.id}`)},getMySellTrades:()=>{const t=JSON.parse(localStorage.getItem("userInfo"));return r.A.get(`/trades/seller/${t?.id}`)},getProductTrades:t=>r.A.get(`/trades/product/${t}`)}}}]);
//# sourceMappingURL=7.5583dc98.js.map