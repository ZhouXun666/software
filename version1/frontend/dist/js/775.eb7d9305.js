"use strict";(self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[]).push([[775],{552:(e,t,r)=>{r.d(t,{Eo:()=>s,Rv:()=>o,a6:()=>l});var a=r(335);const s={register:e=>a.A.post("/users/register",e),login:e=>a.A.post("/users/login",e),getCurrentUser:()=>a.A.get("/users/me"),updateUser:e=>a.A.put("/users/me",e),getUsers:e=>a.A.get("/users",{params:e})},l={createProduct:e=>a.A.post("/products",e),getProducts:e=>a.A.get("/products",{params:e}),getProductById:e=>a.A.get(`/products/${e}`),updateProduct:(e,t)=>a.A.put(`/products/${e}`,t),deleteProduct:e=>a.A.delete(`/products/${e}`),getMyProducts:()=>a.A.get("/products/my"),searchProducts:e=>a.A.get("/products/search",{params:{keyword:e}})},o={applyTrade:e=>a.A.post("/trades/apply",e),acceptTrade:e=>a.A.post(`/trades/${e}/accept`),rejectTrade:e=>a.A.post(`/trades/${e}/reject`),cancelTrade:e=>a.A.post(`/trades/${e}/cancel`),completeTrade:e=>a.A.post(`/trades/${e}/complete`),getTradeById:e=>a.A.get(`/trades/${e}`),getMyBuyTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return a.A.get(`/trades/buyer/${e?.id}`)},getMySellTrades:()=>{const e=JSON.parse(localStorage.getItem("userInfo"));return a.A.get(`/trades/seller/${e?.id}`)},getProductTrades:e=>a.A.get(`/trades/product/${e}`)}},775:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var a=r(641);const s={class:"product-update-container"},l={key:0,class:"loading"},o=["src"],d={key:2,class:"not-found"};function i(e,t,r,i,u,c){const p=(0,a.g2)("el-spinner"),n=(0,a.g2)("el-input"),g=(0,a.g2)("el-form-item"),m=(0,a.g2)("el-option"),h=(0,a.g2)("el-select"),b=(0,a.g2)("Plus"),F=(0,a.g2)("el-icon"),f=(0,a.g2)("el-upload"),k=(0,a.g2)("el-dialog"),y=(0,a.g2)("el-radio"),_=(0,a.g2)("el-radio-group"),A=(0,a.g2)("el-button"),I=(0,a.g2)("el-form"),V=(0,a.g2)("el-card"),$=(0,a.g2)("el-empty");return(0,a.uX)(),(0,a.CE)("div",s,[u.loading?((0,a.uX)(),(0,a.CE)("div",l,[(0,a.bF)(p,{type:"spinner"}),t[7]||(t[7]=(0,a.Lk)("p",null,"加载中...",-1))])):u.product?((0,a.uX)(),(0,a.Wv)(V,{key:1,class:"update-card"},{header:(0,a.k6)(()=>[...t[8]||(t[8]=[(0,a.Lk)("div",{class:"card-header"},"编辑商品",-1)])]),default:(0,a.k6)(()=>[(0,a.bF)(I,{model:u.productForm,rules:u.productRules,ref:"productFormRef","label-width":"100px",class:"update-form"},{default:(0,a.k6)(()=>[(0,a.bF)(g,{label:"商品名称",prop:"name"},{default:(0,a.k6)(()=>[(0,a.bF)(n,{modelValue:u.productForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>u.productForm.name=e),placeholder:"请输入商品名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,a.bF)(g,{label:"商品分类",prop:"categoryId"},{default:(0,a.k6)(()=>[(0,a.bF)(h,{modelValue:u.productForm.categoryId,"onUpdate:modelValue":t[1]||(t[1]=e=>u.productForm.categoryId=e),placeholder:"请选择商品分类"},{default:(0,a.k6)(()=>[(0,a.bF)(m,{label:"电子产品",value:"1"}),(0,a.bF)(m,{label:"图书文具",value:"2"}),(0,a.bF)(m,{label:"服装鞋帽",value:"3"}),(0,a.bF)(m,{label:"生活用品",value:"4"}),(0,a.bF)(m,{label:"其他",value:"5"})]),_:1},8,["modelValue"])]),_:1}),(0,a.bF)(g,{label:"商品价格",prop:"price"},{default:(0,a.k6)(()=>[(0,a.bF)(n,{modelValue:u.productForm.price,"onUpdate:modelValue":t[2]||(t[2]=e=>u.productForm.price=e),modelModifiers:{number:!0},placeholder:"请输入商品价格","prefix-icon":"el-icon-price-tag"},{prepend:(0,a.k6)(()=>[...t[9]||(t[9]=[(0,a.eW)("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),(0,a.bF)(g,{label:"商品图片",prop:"images"},{default:(0,a.k6)(()=>[(0,a.bF)(f,{"file-list":u.fileList,"onUpdate:fileList":t[3]||(t[3]=e=>u.fileList=e),class:"upload-demo",action:"","auto-upload":!1,"on-change":c.handleFileChange,limit:5,"list-type":"picture-card","on-exceed":c.handleExceed},{tip:(0,a.k6)(()=>[...t[10]||(t[10]=[(0,a.Lk)("div",{class:"el-upload__tip"}," 请上传商品图片，最多5张，单张不超过10MB ",-1)])]),default:(0,a.k6)(()=>[(0,a.bF)(F,null,{default:(0,a.k6)(()=>[(0,a.bF)(b)]),_:1})]),_:1},8,["file-list","on-change","on-exceed"]),(0,a.bF)(k,{modelValue:u.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>u.dialogVisible=e),title:"预览",width:"800px"},{default:(0,a.k6)(()=>[(0,a.Lk)("img",{src:u.dialogImageUrl,alt:"预览图片",style:{width:"100%"}},null,8,o)]),_:1},8,["modelValue"])]),_:1}),(0,a.bF)(g,{label:"商品描述",prop:"description"},{default:(0,a.k6)(()=>[(0,a.bF)(n,{modelValue:u.productForm.description,"onUpdate:modelValue":t[5]||(t[5]=e=>u.productForm.description=e),type:"textarea",rows:6,placeholder:"请详细描述商品信息，如：品牌、规格、使用时间、成色等",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,a.bF)(g,{label:"商品状态",prop:"status"},{default:(0,a.k6)(()=>[(0,a.bF)(_,{modelValue:u.productForm.status,"onUpdate:modelValue":t[6]||(t[6]=e=>u.productForm.status=e)},{default:(0,a.k6)(()=>[(0,a.bF)(y,{label:"1"},{default:(0,a.k6)(()=>[...t[11]||(t[11]=[(0,a.eW)("上架",-1)])]),_:1}),(0,a.bF)(y,{label:"0"},{default:(0,a.k6)(()=>[...t[12]||(t[12]=[(0,a.eW)("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,a.bF)(g,null,{default:(0,a.k6)(()=>[(0,a.bF)(A,{type:"primary",onClick:c.submitForm,loading:u.submitting,size:"large"},{default:(0,a.k6)(()=>[...t[13]||(t[13]=[(0,a.eW)("保存修改",-1)])]),_:1},8,["onClick","loading"]),(0,a.bF)(A,{onClick:c.resetForm,size:"large"},{default:(0,a.k6)(()=>[...t[14]||(t[14]=[(0,a.eW)("重置",-1)])]),_:1},8,["onClick"]),(0,a.bF)(A,{onClick:c.goBack,size:"large"},{default:(0,a.k6)(()=>[...t[15]||(t[15]=[(0,a.eW)("返回",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1})):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)($,{description:"商品不存在或已删除"}),(0,a.bF)(A,{type:"primary",onClick:c.goBack},{default:(0,a.k6)(()=>[...t[16]||(t[16]=[(0,a.eW)("返回",-1)])]),_:1},8,["onClick"])]))])}var u=r(548),c=r(552);const p={name:"ProductUpdate",components:{Plus:u.FWt},data(){return{product:null,productForm:{name:"",categoryId:"",price:"",description:"",images:[],status:"1"},productRules:{name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:100,message:"商品名称长度在 2 到 100 个字符",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"},{min:10,max:2e3,message:"商品描述长度在 10 到 2000 个字符",trigger:"blur"}],images:[{required:!0,message:"请至少上传一张商品图片",trigger:"change"}]},fileList:[],dialogVisible:!1,dialogImageUrl:"",loading:!1,submitting:!1}},mounted(){this.loadProductDetail()},methods:{async loadProductDetail(){const e=this.$route.params.id;this.loading=!0;try{const t=await c.a6.getProductById(e);this.product=t,this.productForm={name:t.name,categoryId:t.categoryId,price:t.price,description:t.description,images:this.getImagesArray(t.images),status:t.status.toString()},this.initFileList(this.productForm.images)}catch(t){this.$message.error("加载商品信息失败"),this.product=null}finally{this.loading=!1}},getImagesArray(e){return e?"string"===typeof e?JSON.parse(e):e:[]},initFileList(e){this.fileList=e.map(e=>({url:e,name:e.split("/").pop(),status:"success"}))},handleFileChange(e,t){this.fileList=t,this.productForm.images=t.map(e=>e.url||URL.createObjectURL(e.raw))},handleExceed(e,t){this.$message.warning(`最多只能上传5张图片，已忽略多余${e.length}张图片`)},handlePictureCardPreview(e){this.dialogImageUrl=e.url||URL.createObjectURL(e.raw),this.dialogVisible=!0},async submitForm(){this.$refs.productFormRef.validate(async e=>{if(e){this.submitting=!0;try{const e={name:this.productForm.name,categoryId:this.productForm.categoryId,price:this.productForm.price,description:this.productForm.description,images:JSON.stringify(this.productForm.images),status:parseInt(this.productForm.status)};await c.a6.updateProduct(this.product.id,e),this.$message.success("商品更新成功"),this.$router.push("/user/products")}catch(t){this.$message.error(t.response?.data?.message||"更新失败，请重试")}finally{this.submitting=!1}}})},resetForm(){this.$refs.productFormRef.resetFields(),this.initFileList(this.getImagesArray(this.product.images))},goBack(){this.$router.go(-1)}}};var n=r(262);const g=(0,n.A)(p,[["render",i],["__scopeId","data-v-72b76f0e"]]),m=g}}]);
//# sourceMappingURL=775.eb7d9305.js.map