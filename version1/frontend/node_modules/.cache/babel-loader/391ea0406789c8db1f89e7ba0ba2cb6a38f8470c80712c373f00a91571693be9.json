{"ast":null,"code":"import { Plus } from '@element-plus/icons-vue';\nimport { productAPI, uploadAPI } from '../api';\nexport default {\n  name: 'ProductCreate',\n  components: {\n    Plus\n  },\n  data() {\n    return {\n      productForm: {\n        name: '',\n        categoryId: '',\n        price: '',\n        description: '',\n        images: []\n      },\n      productRules: {\n        name: [{\n          required: true,\n          message: '请输入商品名称',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 100,\n          message: '商品名称长度在 2 到 100 个字符',\n          trigger: 'blur'\n        }],\n        categoryId: [{\n          required: true,\n          message: '请选择商品分类',\n          trigger: 'change'\n        }],\n        price: [{\n          required: true,\n          message: '请输入商品价格',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          min: 0.01,\n          message: '价格必须大于0',\n          trigger: 'blur'\n        }],\n        description: [{\n          required: true,\n          message: '请输入商品描述',\n          trigger: 'blur'\n        }, {\n          min: 10,\n          max: 2000,\n          message: '商品描述长度在 10 到 2000 个字符',\n          trigger: 'blur'\n        }],\n        images: [{\n          required: true,\n          message: '请至少上传一张商品图片',\n          trigger: 'change'\n        }]\n      },\n      fileList: [],\n      dialogVisible: false,\n      dialogImageUrl: '',\n      submitting: false\n    };\n  },\n  methods: {\n    handleFileChange(file, fileList) {\n      this.fileList = fileList;\n      // 更新商品图片数组\n      this.productForm.images = fileList.map(file => {\n        // 如果是已上传的文件，使用url；否则使用本地预览\n        return file.url || URL.createObjectURL(file.raw);\n      });\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`最多只能上传5张图片，已忽略多余${files.length}张图片`);\n    },\n    handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url || URL.createObjectURL(file.raw);\n      this.dialogVisible = true;\n    },\n    handleRemove(file, fileList) {\n      console.log(file);\n      this.fileList = fileList;\n      // 更新商品图片数组\n      this.productForm.images = fileList.map(file => file.url);\n    },\n    async submitForm() {\n      this.$refs.productFormRef.validate(async valid => {\n        if (valid) {\n          this.submitting = true;\n          try {\n            const imagesformData = new FormData();\n            imagesformData.append('file', file.raw);\n            const imageUrl = (await uploadAPI.uploadImage(imagesformData)).data;\n            // 构建表单数据\n            const formData = new FormData();\n            formData.append('name', this.productForm.name);\n            formData.append('categoryId', this.productForm.categoryId);\n            formData.append('price', this.productForm.price);\n            formData.append('description', this.productForm.description);\n\n            // 上传图片（在实际环境中，这里应该先上传图片，然后将图片URL保存）\n            // 由于是演示环境，我们直接使用本地预览URL\n            formData.append('images', imageUrl);\n\n            // 调用API发布商品\n            await productAPI.createProduct(formData);\n            this.$message.success('商品发布成功');\n            // 跳转到我的商品页面\n            this.$router.push('/user/products');\n          } catch (error) {\n            this.$message.error(error.response?.data?.message || '商品发布失败，请重试');\n          } finally {\n            this.submitting = false;\n          }\n        }\n      });\n    },\n    resetForm() {\n      this.$refs.productFormRef.resetFields();\n      this.fileList = [];\n      this.productForm.images = [];\n    },\n    goBack() {\n      this.$router.go(-1);\n    }\n  }\n};","map":{"version":3,"names":["Plus","productAPI","uploadAPI","name","components","data","productForm","categoryId","price","description","images","productRules","required","message","trigger","min","max","type","fileList","dialogVisible","dialogImageUrl","submitting","methods","handleFileChange","file","map","url","URL","createObjectURL","raw","handleExceed","files","$message","warning","length","handlePictureCardPreview","handleRemove","console","log","submitForm","$refs","productFormRef","validate","valid","imagesformData","FormData","append","imageUrl","uploadImage","formData","createProduct","success","$router","push","error","response","resetForm","resetFields","goBack","go"],"sources":["D:\\文档\\学习\\专业课实验报告书\\专业选修\\软件工程\\version1\\frontend\\src\\views\\ProductCreate.vue"],"sourcesContent":["<template>\n  <div class=\"product-create-container\">\n    <el-card class=\"create-card\">\n      <template #header>\n        <div class=\"card-header\">发布二手商品</div>\n      </template>\n      <el-form :model=\"productForm\" :rules=\"productRules\" ref=\"productFormRef\" label-width=\"100px\" class=\"create-form\">\n        <el-form-item label=\"商品名称\" prop=\"name\">\n          <el-input v-model=\"productForm.name\" placeholder=\"请输入商品名称\" maxlength=\"100\" show-word-limit />\n        </el-form-item>\n        <el-form-item label=\"商品分类\" prop=\"categoryId\">\n          <el-select v-model=\"productForm.categoryId\" placeholder=\"请选择商品分类\">\n            <el-option label=\"电子产品\" value=\"1\" />\n            <el-option label=\"图书文具\" value=\"2\" />\n            <el-option label=\"服装鞋帽\" value=\"3\" />\n            <el-option label=\"生活用品\" value=\"4\" />\n            <el-option label=\"其他\" value=\"5\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"商品价格\" prop=\"price\">\n          <el-input v-model.number=\"productForm.price\" placeholder=\"请输入商品价格\" prefix-icon=\"el-icon-price-tag\">\n            <template #prepend>¥</template>\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"商品图片\" prop=\"images\">\n          <el-upload\n            v-model:file-list=\"fileList\"\n            class=\"upload-demo\"\n            action=\"\"\n            :auto-upload=\"false\"\n            :on-change=\"handleFileChange\"\n            :limit=\"5\"\n            list-type=\"picture-card\"\n            :on-preview=\"handlePictureCardPreview\"\n            :on-exceed=\"handleExceed\"\n          >\n            <el-icon><Plus /></el-icon>\n            <template #tip>\n              <div class=\"el-upload__tip\">\n                请上传商品图片，最多5张，单张不超过10MB\n              </div>\n            </template>\n          </el-upload>\n          <el-dialog v-model=\"dialogVisible\" title=\"预览\" width=\"800px\">\n            <img :src=\"dialogImageUrl\" alt=\"预览图片\" style=\"width: 100%\" />\n          </el-dialog>\n        </el-form-item>\n        <el-form-item label=\"商品描述\" prop=\"description\">\n          <el-input\n            v-model=\"productForm.description\"\n            type=\"textarea\"\n            :rows=\"6\"\n            placeholder=\"请详细描述商品信息，如：品牌、规格、使用时间、成色等\"\n            maxlength=\"2000\"\n            show-word-limit\n          />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\" size=\"large\">发布商品</el-button>\n          <el-button @click=\"resetForm\" size=\"large\">重置</el-button>\n          <el-button @click=\"goBack\" size=\"large\">返回</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { Plus } from '@element-plus/icons-vue'\nimport { productAPI, uploadAPI } from '../api'\n\nexport default {\n  name: 'ProductCreate',\n  components: {\n    Plus\n  },\n  data() {\n    return {\n      productForm: {\n        name: '',\n        categoryId: '',\n        price: '',\n        description: '',\n        images:[]\n      },\n      productRules: {\n        name: [\n          { required: true, message: '请输入商品名称', trigger: 'blur' },\n          { min: 2, max: 100, message: '商品名称长度在 2 到 100 个字符', trigger: 'blur' }\n        ],\n        categoryId: [\n          { required: true, message: '请选择商品分类', trigger: 'change' }\n        ],\n        price: [\n          { required: true, message: '请输入商品价格', trigger: 'blur' },\n          { type: 'number', min: 0.01, message: '价格必须大于0', trigger: 'blur' }\n        ],\n        description: [\n          { required: true, message: '请输入商品描述', trigger: 'blur' },\n          { min: 10, max: 2000, message: '商品描述长度在 10 到 2000 个字符', trigger: 'blur' }\n        ],\n        images: [\n          { required: true, message: '请至少上传一张商品图片', trigger: 'change' }\n        ]\n      },\n      fileList: [],\n      dialogVisible: false,\n      dialogImageUrl: '',\n      submitting: false\n    }\n  },\n  methods: {\n    handleFileChange(file, fileList) {\n      this.fileList = fileList\n      // 更新商品图片数组\n      this.productForm.images = fileList.map(file => {\n        // 如果是已上传的文件，使用url；否则使用本地预览\n        return file.url || URL.createObjectURL(file.raw)\n      })\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`最多只能上传5张图片，已忽略多余${files.length}张图片`)\n    },\n    handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url || URL.createObjectURL(file.raw)\n      this.dialogVisible = true\n    },\n    handleRemove(file, fileList) {\n      console.log(file)\n      this.fileList = fileList\n      // 更新商品图片数组\n      this.productForm.images = fileList.map(file => file.url)\n    },\n    async submitForm() {\n      this.$refs.productFormRef.validate(async (valid) => {\n        if (valid) {\n          this.submitting = true\n          try {\n            const imagesformData = new FormData();\n            imagesformData.append('file',file.raw)\n            const imageUrl = (await uploadAPI.uploadImage(imagesformData)).data\n            // 构建表单数据\n            const formData = new FormData()\n            formData.append('name', this.productForm.name)\n            formData.append('categoryId', this.productForm.categoryId)\n            formData.append('price', this.productForm.price)\n            formData.append('description', this.productForm.description)\n            \n            // 上传图片（在实际环境中，这里应该先上传图片，然后将图片URL保存）\n            // 由于是演示环境，我们直接使用本地预览URL\n            formData.append('images', imageUrl)\n            \n            // 调用API发布商品\n            await productAPI.createProduct(formData)\n            \n            this.$message.success('商品发布成功')\n            // 跳转到我的商品页面\n            this.$router.push('/user/products')\n          } catch (error) {\n            this.$message.error(error.response?.data?.message || '商品发布失败，请重试')\n          } finally {\n            this.submitting = false\n          }\n        }\n      })\n    },\n    resetForm() {\n      this.$refs.productFormRef.resetFields()\n      this.fileList = []\n      this.productForm.images = []\n    },\n    goBack() {\n      this.$router.go(-1)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.product-create-container {\n  padding: 0;\n}\n\n.create-card {\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.card-header {\n  font-size: 18px;\n  font-weight: 500;\n  color: #303133;\n}\n\n.create-form {\n  padding-top: 20px;\n}\n\n.upload-demo .el-upload-list {\n  margin-bottom: 16px;\n}\n\n.upload-demo .el-upload {\n  margin-bottom: 16px;\n}\n\n.el-upload__tip {\n  margin-top: 8px;\n  font-size: 14px;\n  color: #909399;\n}\n\n@media (max-width: 768px) {\n  .create-card {\n    max-width: 100%;\n  }\n  \n  .el-form {\n    width: 80px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}