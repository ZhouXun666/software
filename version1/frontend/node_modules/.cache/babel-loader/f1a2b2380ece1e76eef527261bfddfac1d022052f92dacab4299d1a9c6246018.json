{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"product-create-container\"\n};\nconst _hoisted_2 = [\"src\"];\nexport function render(_ctx, _cache) {\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_Plus = _resolveComponent(\"Plus\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, {\n    class: \"create-card\"\n  }, {\n    header: _withCtx(() => [...(_cache[6] || (_cache[6] = [_createElementVNode(\"div\", {\n      class: \"card-header\"\n    }, \"发布二手商品\", -1 /* CACHED */)]))]),\n    default: _withCtx(() => [_createVNode(_component_el_form, {\n      model: _ctx.productForm,\n      rules: _ctx.productRules,\n      ref: \"productFormRef\",\n      \"label-width\": \"100px\",\n      class: \"create-form\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_form_item, {\n        label: \"商品名称\",\n        prop: \"name\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          modelValue: _ctx.productForm.name,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => _ctx.productForm.name = $event),\n          placeholder: \"请输入商品名称\",\n          maxlength: \"100\",\n          \"show-word-limit\": \"\"\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"商品分类\",\n        prop: \"categoryId\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_select, {\n          modelValue: _ctx.productForm.categoryId,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.productForm.categoryId = $event),\n          placeholder: \"请选择商品分类\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_option, {\n            label: \"电子产品\",\n            value: \"1\"\n          }), _createVNode(_component_el_option, {\n            label: \"图书文具\",\n            value: \"2\"\n          }), _createVNode(_component_el_option, {\n            label: \"服装鞋帽\",\n            value: \"3\"\n          }), _createVNode(_component_el_option, {\n            label: \"生活用品\",\n            value: \"4\"\n          }), _createVNode(_component_el_option, {\n            label: \"其他\",\n            value: \"5\"\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"商品价格\",\n        prop: \"price\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          modelValue: _ctx.productForm.price,\n          \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => _ctx.productForm.price = $event),\n          modelModifiers: {\n            number: true\n          },\n          placeholder: \"请输入商品价格\",\n          \"prefix-icon\": \"el-icon-price-tag\"\n        }, {\n          prepend: _withCtx(() => [...(_cache[7] || (_cache[7] = [_createTextVNode(\"¥\", -1 /* CACHED */)]))]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"商品图片\",\n        prop: \"images\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_upload, {\n          \"file-list\": _ctx.fileList,\n          \"onUpdate:fileList\": _cache[3] || (_cache[3] = $event => _ctx.fileList = $event),\n          class: \"upload-demo\",\n          action: \"\",\n          \"auto-upload\": false,\n          \"on-change\": _ctx.handleFileChange,\n          limit: 5,\n          \"list-type\": \"picture-card\",\n          \"on-exceed\": _ctx.handleExceed\n        }, {\n          tip: _withCtx(() => [...(_cache[8] || (_cache[8] = [_createElementVNode(\"div\", {\n            class: \"el-upload__tip\"\n          }, \" 请上传商品图片，最多5张，单张不超过10MB \", -1 /* CACHED */)]))]),\n          default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n            default: _withCtx(() => [_createVNode(_component_Plus)]),\n            _: 1 /* STABLE */\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"file-list\", \"on-change\", \"on-exceed\"]), _createVNode(_component_el_dialog, {\n          modelValue: _ctx.dialogVisible,\n          \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => _ctx.dialogVisible = $event),\n          title: \"预览\",\n          width: \"800px\"\n        }, {\n          default: _withCtx(() => [_createElementVNode(\"img\", {\n            src: _ctx.dialogImageUrl,\n            alt: \"预览图片\",\n            style: {\n              \"width\": \"100%\"\n            }\n          }, null, 8 /* PROPS */, _hoisted_2)]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, {\n        label: \"商品描述\",\n        prop: \"description\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          modelValue: _ctx.productForm.description,\n          \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => _ctx.productForm.description = $event),\n          type: \"textarea\",\n          rows: 6,\n          placeholder: \"请详细描述商品信息，如：品牌、规格、使用时间、成色等\",\n          maxlength: \"2000\",\n          \"show-word-limit\": \"\"\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_form_item, null, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: _ctx.submitForm,\n          loading: _ctx.submitting,\n          size: \"large\"\n        }, {\n          default: _withCtx(() => [...(_cache[9] || (_cache[9] = [_createTextVNode(\"发布商品\", -1 /* CACHED */)]))]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\", \"loading\"]), _createVNode(_component_el_button, {\n          onClick: _ctx.resetForm,\n          size: \"large\"\n        }, {\n          default: _withCtx(() => [...(_cache[10] || (_cache[10] = [_createTextVNode(\"重置\", -1 /* CACHED */)]))]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_button, {\n          onClick: _ctx.goBack,\n          size: \"large\"\n        }, {\n          default: _withCtx(() => [...(_cache[11] || (_cache[11] = [_createTextVNode(\"返回\", -1 /* CACHED */)]))]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"model\", \"rules\"])]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_cache","_createElementVNode","_component_el_form","model","_ctx","productForm","rules","productRules","ref","_component_el_form_item","label","prop","_component_el_input","name","$event","placeholder","maxlength","_component_el_select","categoryId","_component_el_option","value","price","number","prepend","_component_el_upload","fileList","action","handleFileChange","limit","handleExceed","tip","_component_el_icon","_component_Plus","_component_el_dialog","dialogVisible","title","width","src","dialogImageUrl","alt","style","description","type","rows","_component_el_button","onClick","submitForm","loading","submitting","size","resetForm","goBack"],"sources":["D:\\文档\\学习\\专业课实验报告书\\专业选修\\软件工程\\version1\\frontend\\src\\views\\ProductCreate.vue"],"sourcesContent":["<template>\n  <div class=\"product-create-container\">\n    <el-card class=\"create-card\">\n      <template #header>\n        <div class=\"card-header\">发布二手商品</div>\n      </template>\n      <el-form :model=\"productForm\" :rules=\"productRules\" ref=\"productFormRef\" label-width=\"100px\" class=\"create-form\">\n        <el-form-item label=\"商品名称\" prop=\"name\">\n          <el-input v-model=\"productForm.name\" placeholder=\"请输入商品名称\" maxlength=\"100\" show-word-limit />\n        </el-form-item>\n        <el-form-item label=\"商品分类\" prop=\"categoryId\">\n          <el-select v-model=\"productForm.categoryId\" placeholder=\"请选择商品分类\">\n            <el-option label=\"电子产品\" value=\"1\" />\n            <el-option label=\"图书文具\" value=\"2\" />\n            <el-option label=\"服装鞋帽\" value=\"3\" />\n            <el-option label=\"生活用品\" value=\"4\" />\n            <el-option label=\"其他\" value=\"5\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"商品价格\" prop=\"price\">\n          <el-input v-model.number=\"productForm.price\" placeholder=\"请输入商品价格\" prefix-icon=\"el-icon-price-tag\">\n            <template #prepend>¥</template>\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"商品图片\" prop=\"images\">\n          <el-upload\n            v-model:file-list=\"fileList\"\n            class=\"upload-demo\"\n            action=\"\"\n            :auto-upload=\"false\"\n            :on-change=\"handleFileChange\"\n            :limit=\"5\"\n            list-type=\"picture-card\"\n            :on-exceed=\"handleExceed\"\n          >\n            <el-icon><Plus /></el-icon>\n            <template #tip>\n              <div class=\"el-upload__tip\">\n                请上传商品图片，最多5张，单张不超过10MB\n              </div>\n            </template>\n          </el-upload>\n          <el-dialog v-model=\"dialogVisible\" title=\"预览\" width=\"800px\">\n            <img :src=\"dialogImageUrl\" alt=\"预览图片\" style=\"width: 100%\" />\n          </el-dialog>\n        </el-form-item>\n        <el-form-item label=\"商品描述\" prop=\"description\">\n          <el-input\n            v-model=\"productForm.description\"\n            type=\"textarea\"\n            :rows=\"6\"\n            placeholder=\"请详细描述商品信息，如：品牌、规格、使用时间、成色等\"\n            maxlength=\"2000\"\n            show-word-limit\n          />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\" size=\"large\">发布商品</el-button>\n          <el-button @click=\"resetForm\" size=\"large\">重置</el-button>\n          <el-button @click=\"goBack\" size=\"large\">返回</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { Plus } from '@element-plus/icons-vue'\nimport { productAPI, uploadAPI } from '../api'\n\nexport default {\n  name: 'ProductCreate',\n  components: {\n    Plus\n  },\n  data() {\n    return {\n      productForm: {\n        name: '',\n        categoryId: '',\n        price: '',\n        description: '',\n        images: []\n      },\n      productRules: {\n        name: [\n          { required: true, message: '请输入商品名称', trigger: 'blur' },\n          { min: 2, max: 100, message: '商品名称长度在 2 到 100 个字符', trigger: 'blur' }\n        ],\n        categoryId: [\n          { required: true, message: '请选择商品分类', trigger: 'change' }\n        ],\n        price: [\n          { required: true, message: '请输入商品价格', trigger: 'blur' },\n          { type: 'number', min: 0.01, message: '价格必须大于0', trigger: 'blur' }\n        ],\n        description: [\n          { required: true, message: '请输入商品描述', trigger: 'blur' },\n          { min: 10, max: 2000, message: '商品描述长度在 10 到 2000 个字符', trigger: 'blur' }\n        ],\n        images: [\n          { required: true, message: '请至少上传一张商品图片', trigger: 'change' }\n        ]\n      },\n      fileList: [],\n      dialogVisible: false,\n      dialogImageUrl: '',\n      submitting: false\n    }\n  },\n  methods: {\n    handleFileChange(file, fileList) {\n      this.fileList = fileList\n      // 更新商品图片数组\n      this.productForm.images = fileList.map(file => {\n        // 如果是已上传的文件，使用url；否则使用本地预览\n        return file.url || URL.createObjectURL(file.raw)\n      })\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`最多只能上传5张图片，已忽略多余${files.length}张图片`)\n    },\n    handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url || URL.createObjectURL(file.raw)\n      this.dialogVisible = true\n    },\n    handleRemove(file, fileList) {\n      this.fileList = fileList\n      // 更新商品图片数组\n      this.productForm.images = fileList.map(file => file.url)\n    },\n    async submitForm() {\n      this.$refs.productFormRef.validate(async (valid) => {\n        if (valid) {\n          this.submitting = true\n          try {\n            const formData = new FormData();\n            formData.append('file',this.productForm.images)\n            const imageUrl = (await uploadAPI.uploadImage(formData)).data\n            // 构建表单数据\n            const formData = new FormData()\n            formData.append('name', this.productForm.name)\n            formData.append('categoryId', this.productForm.categoryId)\n            formData.append('price', this.productForm.price)\n            formData.append('description', this.productForm.description)\n            \n            // 上传图片（在实际环境中，这里应该先上传图片，然后将图片URL保存）\n            // 由于是演示环境，我们直接使用本地预览URL\n            formData.append('images', imageUrl)\n            \n            // 调用API发布商品\n            await productAPI.createProduct(formData)\n            \n            this.$message.success('商品发布成功')\n            // 跳转到我的商品页面\n            this.$router.push('/user/products')\n          } catch (error) {\n            this.$message.error(error.response?.data?.message || '商品发布失败，请重试')\n          } finally {\n            this.submitting = false\n          }\n        }\n      })\n    },\n    resetForm() {\n      this.$refs.productFormRef.resetFields()\n      this.fileList = []\n      this.productForm.images = []\n    },\n    goBack() {\n      this.$router.go(-1)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.product-create-container {\n  padding: 0;\n}\n\n.create-card {\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.card-header {\n  font-size: 18px;\n  font-weight: 500;\n  color: #303133;\n}\n\n.create-form {\n  padding-top: 20px;\n}\n\n.upload-demo .el-upload-list {\n  margin-bottom: 16px;\n}\n\n.upload-demo .el-upload {\n  margin-bottom: 16px;\n}\n\n.el-upload__tip {\n  margin-top: 8px;\n  font-size: 14px;\n  color: #909399;\n}\n\n@media (max-width: 768px) {\n  .create-card {\n    max-width: 100%;\n  }\n  \n  .el-form {\n    width: 80px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}