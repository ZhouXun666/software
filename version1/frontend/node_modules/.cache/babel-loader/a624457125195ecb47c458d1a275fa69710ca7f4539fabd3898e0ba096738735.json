{"ast":null,"code":"import { Plus } from '@element-plus/icons-vue';\nimport { productAPI, uploadAPI } from '../api';\nexport default {\n  name: 'ProductUpdate',\n  components: {\n    Plus\n  },\n  data() {\n    return {\n      product: null,\n      productForm: {\n        name: '',\n        categoryId: '',\n        price: '',\n        description: '',\n        images: '',\n        status: '1'\n      },\n      productRules: {\n        name: [{\n          required: true,\n          message: '请输入商品名称',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 100,\n          message: '商品名称长度在 2 到 100 个字符',\n          trigger: 'blur'\n        }],\n        categoryId: [{\n          required: true,\n          message: '请选择商品分类',\n          trigger: 'change'\n        }],\n        price: [{\n          required: true,\n          message: '请输入商品价格',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          min: 0.01,\n          message: '价格必须大于0',\n          trigger: 'blur'\n        }],\n        description: [{\n          required: true,\n          message: '请输入商品描述',\n          trigger: 'blur'\n        }, {\n          min: 10,\n          max: 2000,\n          message: '商品描述长度在 10 到 2000 个字符',\n          trigger: 'blur'\n        }],\n        images: [{\n          required: true,\n          message: '请至少上传一张商品图片',\n          trigger: 'change'\n        }]\n      },\n      fileList: [],\n      dialogVisible: false,\n      dialogImageUrl: '',\n      loading: false,\n      submitting: false\n    };\n  },\n  mounted() {\n    this.loadProductDetail();\n  },\n  methods: {\n    async loadProductDetail() {\n      const productId = this.$route.params.id;\n      this.loading = true;\n      try {\n        const response = await productAPI.getProductById(productId);\n        this.product = response;\n        // 填充表单数据\n        this.productForm = {\n          name: response.name,\n          categoryId: response.categoryId,\n          price: response.price,\n          description: response.description,\n          images: this.getImages(response.images),\n          status: response.status.toString()\n        };\n        // 初始化文件列表\n        this.initFileList(this.productForm.images);\n      } catch (error) {\n        this.$message.error('加载商品信息失败');\n        this.product = null;\n      } finally {\n        this.loading = false;\n      }\n    },\n    getImages(images) {\n      if (!images) return 'https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png';\n      const baseURL = 'http://localhost:8080/';\n      return `${baseURL}${images}`;\n    },\n    initFileList(imageUrl) {\n      this.fileList = [{\n        url: imageUrl\n      }];\n    },\n    handleFileChange(file, fileList) {\n      this.fileList = fileList;\n      // 更新商品图片数组\n      this.productForm.images = file => {\n        return file.url || URL.createObjectURL(file.raw);\n      };\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`最多只能上传5张图片，已忽略多余${files.length}张图片`);\n    },\n    handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url || URL.createObjectURL(file.raw);\n      this.dialogVisible = true;\n      console.log(this.dialogImageUrl);\n    },\n    async submitForm() {\n      this.$refs.productFormRef.validate(async valid => {\n        if (valid) {\n          this.submitting = true;\n          try {\n            const imageUrl = '';\n            if (this.fileList[0].raw) {\n              const imagesformData = new FormData();\n              imagesformData.append('file', this.fileList[0].raw);\n              imageUrl = await uploadAPI.uploadImage(imagesformData);\n            } else {\n              imageUrl = this.productForm.images.split(\"http://localhost:8080/\")[1];\n            }\n            const formData = {\n              name: this.productForm.name,\n              categoryId: this.productForm.categoryId,\n              price: this.productForm.price,\n              description: this.productForm.description,\n              images: this.productForm.images,\n              status: parseInt(this.productForm.status)\n            };\n            await productAPI.updateProduct(this.product.id, formData);\n            this.$message.success('商品更新成功');\n            this.$router.push('/user/products');\n          } catch (error) {\n            this.$message.error(error.response?.data?.message || '更新失败，请重试');\n          } finally {\n            this.submitting = false;\n          }\n        }\n      });\n    },\n    resetForm() {\n      this.$refs.productFormRef.resetFields();\n      // 重新初始化文件列表\n      this.initFileList(this.getImages(this.product.images));\n    },\n    goBack() {\n      this.$router.go(-1);\n    }\n  }\n};","map":{"version":3,"names":["Plus","productAPI","uploadAPI","name","components","data","product","productForm","categoryId","price","description","images","status","productRules","required","message","trigger","min","max","type","fileList","dialogVisible","dialogImageUrl","loading","submitting","mounted","loadProductDetail","methods","productId","$route","params","id","response","getProductById","getImages","toString","initFileList","error","$message","baseURL","imageUrl","url","handleFileChange","file","URL","createObjectURL","raw","handleExceed","files","warning","length","handlePictureCardPreview","console","log","submitForm","$refs","productFormRef","validate","valid","imagesformData","FormData","append","uploadImage","split","formData","parseInt","updateProduct","success","$router","push","resetForm","resetFields","goBack","go"],"sources":["D:\\文档\\学习\\专业课实验报告书\\专业选修\\软件工程\\version1\\frontend\\src\\views\\ProductUpdate.vue"],"sourcesContent":["<template>\n  <div class=\"product-update-container\">\n    <div v-if=\"loading\" class=\"loading\">\n      <el-spinner type=\"spinner\" />\n      <p>加载中...</p>\n    </div>\n    <el-card v-else-if=\"product\" class=\"update-card\">\n      <template #header>\n        <div class=\"card-header\">编辑商品</div>\n      </template>\n      <el-form :model=\"productForm\" :rules=\"productRules\" ref=\"productFormRef\" label-width=\"100px\" class=\"update-form\">\n        <el-form-item label=\"商品名称\" prop=\"name\">\n          <el-input v-model=\"productForm.name\" placeholder=\"请输入商品名称\" maxlength=\"100\" show-word-limit />\n        </el-form-item>\n        <el-form-item label=\"商品分类\" prop=\"categoryId\">\n          <el-select v-model=\"productForm.categoryId\" placeholder=\"请选择商品分类\">\n            <el-option label=\"电子产品\" value=\"1\" />\n            <el-option label=\"图书文具\" value=\"2\" />\n            <el-option label=\"服装鞋帽\" value=\"3\" />\n            <el-option label=\"生活用品\" value=\"4\" />\n            <el-option label=\"其他\" value=\"5\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"商品价格\" prop=\"price\">\n          <el-input v-model.number=\"productForm.price\" placeholder=\"请输入商品价格\" prefix-icon=\"el-icon-price-tag\">\n            <template #prepend>¥</template>\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"商品图片\" prop=\"images\">\n          <el-upload\n            v-model:file-list=\"fileList\"\n            class=\"upload-demo\"\n            action=\"\"\n            :auto-upload=\"false\"\n            :on-change=\"handleFileChange\"\n            :limit=\"5\"\n            list-type=\"picture-card\"\n            :on-preview=\"handlePictureCardPreview\"\n            :on-exceed=\"handleExceed\"\n          >\n            <el-icon><Plus /></el-icon>\n            <template #tip>\n              <div class=\"el-upload__tip\">\n                请上传商品图片，最多5张，单张不超过10MB\n              </div>\n            </template>\n          </el-upload>\n          <el-dialog v-model=\"dialogVisible\" title=\"预览\" width=\"800px\">\n            <img :src= \"dialogImageUrl\" alt=\"预览图片\" style=\"width: 100%\" />\n          </el-dialog>\n        </el-form-item>\n        <el-form-item label=\"商品描述\" prop=\"description\">\n          <el-input\n            v-model=\"productForm.description\"\n            type=\"textarea\"\n            :rows=\"6\"\n            placeholder=\"请详细描述商品信息，如：品牌、规格、使用时间、成色等\"\n            maxlength=\"2000\"\n            show-word-limit\n          />\n        </el-form-item>\n        <el-form-item label=\"商品状态\" prop=\"status\">\n          <el-radio-group v-model=\"productForm.status\">\n            <el-radio label=\"1\">上架</el-radio>\n            <el-radio label=\"0\">下架</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\" size=\"large\">保存修改</el-button>\n          <el-button @click=\"resetForm\" size=\"large\">重置</el-button>\n          <el-button @click=\"goBack\" size=\"large\">返回</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    <div v-else class=\"not-found\">\n      <el-empty description=\"商品不存在或已删除\" />\n      <el-button type=\"primary\" @click=\"goBack\">返回</el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Plus } from '@element-plus/icons-vue'\nimport { productAPI, uploadAPI} from '../api'\n\nexport default {\n  name: 'ProductUpdate',\n  components: {\n    Plus\n  },\n  data() {\n    return {\n      product: null,\n      productForm: {\n        name: '',\n        categoryId: '',\n        price: '',\n        description: '',\n        images: '',\n        status: '1'\n      },\n      productRules: {\n        name: [\n          { required: true, message: '请输入商品名称', trigger: 'blur' },\n          { min: 2, max: 100, message: '商品名称长度在 2 到 100 个字符', trigger: 'blur' }\n        ],\n        categoryId: [\n          { required: true, message: '请选择商品分类', trigger: 'change' }\n        ],\n        price: [\n          { required: true, message: '请输入商品价格', trigger: 'blur' },\n          { type: 'number', min: 0.01, message: '价格必须大于0', trigger: 'blur' }\n        ],\n        description: [\n          { required: true, message: '请输入商品描述', trigger: 'blur' },\n          { min: 10, max: 2000, message: '商品描述长度在 10 到 2000 个字符', trigger: 'blur' }\n        ],\n        images: [\n          { required: true, message: '请至少上传一张商品图片', trigger: 'change' }\n        ]\n      },\n      fileList: [],\n      dialogVisible: false,\n      dialogImageUrl: '',\n      loading: false,\n      submitting: false\n    }\n  },\n  mounted() {\n    this.loadProductDetail()\n  },\n  methods: {\n    async loadProductDetail() {\n      const productId = this.$route.params.id\n      this.loading = true\n      try {\n        const response = await productAPI.getProductById(productId)\n        this.product = response\n        // 填充表单数据\n        this.productForm = {\n          name: response.name,\n          categoryId: response.categoryId,\n          price: response.price,\n          description: response.description,\n          images: this.getImages(response.images),\n          status: response.status.toString()\n        }\n        // 初始化文件列表\n        this.initFileList(this.productForm.images)\n      } catch (error) {\n        this.$message.error('加载商品信息失败')\n        this.product = null\n      } finally {\n        this.loading = false\n      }\n    },\n    getImages(images) {\n      if (!images) return 'https://img.alicdn.com/imgextra/i4/O1CN01q0UcHt1h1sVt0jA8O_!!6000000004122-2-tps-112-112.png'\n      const baseURL = 'http://localhost:8080/'\n      return `${baseURL}${images}`\n    },\n    initFileList(imageUrl) {\n      this.fileList = [\n        {\n          url: imageUrl\n        }\n      ];\n    },\n    handleFileChange(file, fileList) {\n      this.fileList = fileList\n      // 更新商品图片数组\n      this.productForm.images = file => {return file.url || URL.createObjectURL(file.raw)}\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`最多只能上传5张图片，已忽略多余${files.length}张图片`)\n    },\n    handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url || URL.createObjectURL(file.raw)\n      this.dialogVisible = true\n      console.log(this.dialogImageUrl)\n    },\n    async submitForm() {\n      this.$refs.productFormRef.validate(async (valid) => {\n        if (valid) {\n          this.submitting = true\n          try {\n            const imageUrl = ''\n            if(this.fileList[0].raw){\n              const imagesformData = new FormData();\n              imagesformData.append('file',this.fileList[0].raw)\n              imageUrl = (await uploadAPI.uploadImage(imagesformData))\n            }else{\n              imageUrl = this.productForm.images.split(\"http://localhost:8080/\")[1]\n            }\n            const formData = {\n              name: this.productForm.name,\n              categoryId: this.productForm.categoryId,\n              price: this.productForm.price,\n              description: this.productForm.description,\n              images: this.productForm.images,\n              status: parseInt(this.productForm.status)\n            }\n            \n            await productAPI.updateProduct(this.product.id, formData)\n            \n            this.$message.success('商品更新成功')\n            this.$router.push('/user/products')\n          } catch (error) {\n            this.$message.error(error.response?.data?.message || '更新失败，请重试')\n          } finally {\n            this.submitting = false\n          }\n        }\n      })\n    },\n    resetForm() {\n      this.$refs.productFormRef.resetFields()\n      // 重新初始化文件列表\n      this.initFileList(this.getImages(this.product.images))\n    },\n    goBack() {\n      this.$router.go(-1)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.product-update-container {\n  padding: 0;\n}\n\n.loading,\n.not-found {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 400px;\n  gap: 20px;\n}\n\n.update-card {\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.card-header {\n  font-size: 18px;\n  font-weight: 500;\n  color: #303133;\n}\n\n.update-form {\n  padding-top: 20px;\n}\n\n.upload-demo .el-upload-list {\n  margin-bottom: 16px;\n}\n\n.upload-demo .el-upload {\n  margin-bottom: 16px;\n}\n\n.el-upload__tip {\n  margin-top: 8px;\n  font-size: 14px;\n  color: #909399;\n}\n\n@media (max-width: 768px) {\n  .update-card {\n    max-width: 100%;\n  }\n  \n  .el-form {\n    width: 80px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}